<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linear Algebra Visual Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-dark': '#4A49B0',
                    }
                }
            }
        }
    </script>
    <style>
        canvas {
            max-width: 100%;
            margin: 0 auto;
        }
        .slide {
            display: none;
            height: 100%;
            overflow-y: auto;
        }
        .active {
            display: block;
        }
        .matrix-table {
            border-collapse: collapse;
            display: table;
            margin: 0 auto;
        }
        .matrix-table tr {
            display: table-row;
        }
        .matrix-table td {
            display: table-cell;
        }
        .matrix-cell {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #ccc;
        }
        .dark .matrix-cell {
            border-color: #555;
        }
        .vector-arrow {
            stroke-width: 2;
            marker-end: url(#arrowhead);
        }
        .axis-line {
            stroke-width: 1;
        }
        .system-equation {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }
        @media (max-width: 640px) {
            .matrix-cell {
                width: 30px;
                height: 30px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body class="bg-white dark:bg-[#181818] text-gray-900 dark:text-gray-100 min-h-screen flex flex-col">
    <header class="bg-primary text-white p-4 shadow-md">
        <h1 class="text-2xl font-bold text-center">Linear Algebra Visual Guide</h1>
    </header>

    <div class="flex-1 flex flex-col md:flex-row">
        <!-- Sidebar navigation -->
        <nav class="md:w-64 bg-gray-100 dark:bg-gray-900 p-4 overflow-y-auto">
            <h2 class="text-lg font-semibold mb-4">Topics</h2>
            <ul class="space-y-2" id="topic-list">
                <!-- List items will be populated by JavaScript -->
            </ul>
        </nav>

        <!-- Main content area -->
        <main class="flex-1 p-4 flex flex-col" id="main-content">
            <!-- Slides will be populated by JavaScript -->
        </main>
    </div>

    <!-- Navigation controls -->
    <footer class="bg-gray-100 dark:bg-gray-900 p-4 shadow-md">
        <div class="flex justify-between items-center">
            <button id="prev-btn" class="px-4 py-2 bg-primary hover:bg-primary-dark text-white rounded">Previous</button>
            <span id="slide-indicator" class="text-sm"></span>
            <div class="flex gap-2">
                <button id="theme-toggle" class="p-2 rounded bg-gray-200 dark:bg-gray-700">
                    <span class="dark:hidden">üåô</span>
                    <span class="hidden dark:inline">‚òÄÔ∏è</span>
                </button>
                <button id="next-btn" class="px-4 py-2 bg-primary hover:bg-primary-dark text-white rounded">Next</button>
            </div>
        </div>
    </footer>

    <!-- SVG Definitions -->
    <svg width="0" height="0">
        <defs>
            <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                <polygon points="0 0, 10 3.5, 0 7" fill="#5D5CDE" class="dark:fill-white" />
            </marker>
        </defs>
    </svg>

    <script>
        // Slide content data
        const slides = [
            {
                id: 'intro',
                title: 'Introduction to Linear Algebra',
                content: `
                    <div class="flex flex-col items-center space-y-6">
                        <h2 class="text-2xl font-bold text-primary dark:text-white">Linear Algebra Visual Guide</h2>
                        <p class="text-center max-w-2xl">
                            This interactive presentation covers key concepts in linear algebra with visual demonstrations.
                            Click through the topics to explore various concepts and animations.
                        </p>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-4 w-full max-w-3xl mt-4">
                            <div class="aspect-square bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center p-4">
                                <div class="text-center">
                                    <div class="text-4xl mb-2">üßÆ</div>
                                    <div class="font-medium">Systems of Equations</div>
                                </div>
                            </div>
                            <div class="aspect-square bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center p-4">
                                <div class="text-center">
                                    <div class="text-4xl mb-2">üìä</div>
                                    <div class="font-medium">Matrices</div>
                                </div>
                            </div>
                            <div class="aspect-square bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center p-4">
                                <div class="text-center">
                                    <div class="text-4xl mb-2">üîç</div>
                                    <div class="font-medium">Determinants</div>
                                </div>
                            </div>
                            <div class="aspect-square bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center p-4">
                                <div class="text-center">
                                    <div class="text-4xl mb-2">‚ÜîÔ∏è</div>
                                    <div class="font-medium">Gauss-Jordan Elimination</div>
                                </div>
                            </div>
                            <div class="aspect-square bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center p-4">
                                <div class="text-center">
                                    <div class="text-4xl mb-2">‚ÜóÔ∏è</div>
                                    <div class="font-medium">Vectors</div>
                                </div>
                            </div>
                            <div class="aspect-square bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center p-4">
                                <div class="text-center">
                                    <div class="text-4xl mb-2">üîÑ</div>
                                    <div class="font-medium">Transformations</div>
                                </div>
                            </div>
                            <div class="aspect-square bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center p-4">
                                <div class="text-center">
                                    <div class="text-4xl mb-2">üîÜ</div>
                                    <div class="font-medium">Eigenvalues & Eigenvectors</div>
                                </div>
                            </div>
                            <div class="aspect-square bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center p-4">
                                <div class="text-center">
                                    <div class="text-4xl mb-2">üìà</div>
                                    <div class="font-medium">Stock Portfolio Analysis</div>
                                </div>
                            </div>
                            <div class="aspect-square bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center p-4">
                                <div class="text-center">
                                    <div class="text-4xl mb-2">üìâ</div>
                                    <div class="font-medium">Least Squares Regression</div>
                                </div>
                            </div>
                        </div>
                        <p class="text-center text-xs text-gray-500 mt-2">
                            Co-created by Dr. Wilson Yu and Poe App Creator in 2025
                        </p>
                    </div>
                `
            },
            {
                id: 'linear-systems',
                title: 'Systems of Linear Equations',
                content: `
                    <div class="flex flex-col space-y-6">
                        <h2 class="text-xl font-bold">Systems of Linear Equations</h2>
                        <p>A system of linear equations represents multiple linear constraints that must be satisfied simultaneously.</p>
                        
                        <div class="flex flex-col md:flex-row gap-6 items-center justify-center mb-4">
                            <div class="system-demo bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                                <h3 class="text-lg font-semibold mb-2">Example System:</h3>
                                <div id="system-equations" class="font-mono mb-4">
                                    <!-- Equations will be rendered here -->
                                </div>
                                <div class="flex justify-center mb-2">
                                    <button id="new-system" class="px-3 py-1 bg-primary text-white rounded">Generate New System</button>
                                </div>
                            </div>
                            
                            <div class="visualization-container w-full max-w-md">
                                <h3 class="text-lg font-semibold mb-2">Geometric Interpretation:</h3>
                                <canvas id="linear-system-canvas" width="400" height="400" class="bg-white dark:bg-gray-700 rounded-lg shadow-md"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-2">Types of Solutions:</h3>
                            <ul class="list-disc pl-5 space-y-2">
                                <li><span class="font-semibold">Unique solution:</span> Lines intersect at exactly one point</li>
                                <li><span class="font-semibold">No solution:</span> Lines are parallel (inconsistent system)</li>
                                <li><span class="font-semibold">Infinite solutions:</span> Lines are identical (dependent equations)</li>
                            </ul>
                        </div>
                    </div>
                `
            },
            {
                id: 'gauss-jordan',
                title: 'Gauss-Jordan Elimination',
                content: `
                    <div class="flex flex-col space-y-6">
                        <h2 class="text-xl font-bold">Gauss-Jordan Elimination</h2>
                        <p>Gauss-Jordan Elimination is a systematic procedure to solve systems of linear equations by transforming the augmented matrix to reduced row echelon form (RREF).</p>
                        
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-2">Steps in Gauss-Jordan Elimination:</h3>
                            <ol class="list-decimal pl-5 space-y-2">
                                <li>Write the augmented matrix</li>
                                <li>Find a pivot (first non-zero element) in the leftmost column</li>
                                <li>Use row operations to make all other entries in the pivot column zero</li>
                                <li>Repeat for each column from left to right</li>
                                <li>Scale each row to make pivots equal to 1</li>
                            </ol>
                        </div>
                        
                        <div class="flex flex-col items-center">
                            <h3 class="text-lg font-semibold mb-2">Interactive Demonstration:</h3>
                            <div id="gauss-jordan-demo" class="w-full max-w-2xl">
                                <div id="augmented-matrix" class="flex justify-center mb-4">
                                    <!-- Augmented matrix will be rendered here -->
                                </div>
                                <div class="flex flex-wrap justify-center gap-2 mb-4">
                                    <button id="gj-reset" class="px-3 py-1 bg-primary text-white rounded">Reset</button>
                                    <button id="gj-next-step" class="px-3 py-1 bg-primary text-white rounded">Next Step</button>
                                    <button id="gj-auto" class="px-3 py-1 bg-primary text-white rounded">Auto Solve</button>
                                </div>
                                <div id="gj-explanation" class="bg-gray-100 dark:bg-gray-700 p-3 rounded">
                                    Click "Next Step" to begin Gauss-Jordan elimination.
                                </div>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                id: 'matrix-form',
                title: 'Matrix Form',
                content: `
                    <div class="flex flex-col space-y-6">
                        <h2 class="text-xl font-bold">Matrix Form of Linear Systems</h2>
                        <p>Any system of linear equations can be represented in matrix form as Ax = b.</p>
                        
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg mb-4">
                            <h3 class="text-lg font-semibold mb-2">Matrix Representation:</h3>
                            <div class="flex flex-col md:flex-row items-center justify-center gap-4 flex-wrap">
                                <div class="system-equations font-mono">
                                    <div>a‚ÇÅ‚ÇÅx‚ÇÅ + a‚ÇÅ‚ÇÇx‚ÇÇ + ... + a‚ÇÅ‚Çôx‚Çô = b‚ÇÅ</div>
                                    <div>a‚ÇÇ‚ÇÅx‚ÇÅ + a‚ÇÇ‚ÇÇx‚ÇÇ + ... + a‚ÇÇ‚Çôx‚Çô = b‚ÇÇ</div>
                                    <div>‚ãÆ</div>
                                    <div>a‚Çò‚ÇÅx‚ÇÅ + a‚Çò‚ÇÇx‚ÇÇ + ... + a‚Çò‚Çôx‚Çô = b‚Çò</div>
                                </div>
                                <div class="text-2xl">‚üπ</div>
                                <div class="matrix-form flex items-center font-mono">
                                    <div class="flex items-center">
                                        <div class="matrix-bracket">[</div>
                                        <div class="matrix-entries">
                                            a‚ÇÅ‚ÇÅ a‚ÇÅ‚ÇÇ ... a‚ÇÅ‚Çô<br>
                                            a‚ÇÇ‚ÇÅ a‚ÇÇ‚ÇÇ ... a‚ÇÇ‚Çô<br>
                                            ‚ãÆ<br>
                                            a‚Çò‚ÇÅ a‚Çò‚ÇÇ ... a‚Çò‚Çô
                                        </div>
                                        <div class="matrix-bracket">]</div>
                                    </div>
                                    <div class="mx-2">
                                        <div class="matrix-bracket">[</div>
                                        <div class="matrix-entries">
                                            x‚ÇÅ<br>
                                            x‚ÇÇ<br>
                                            ‚ãÆ<br>
                                            x‚Çô
                                        </div>
                                        <div class="matrix-bracket">]</div>
                                    </div>
                                    <div class="mx-2">=</div>
                                    <div>
                                        <div class="matrix-bracket">[</div>
                                        <div class="matrix-entries">
                                            b‚ÇÅ<br>
                                            b‚ÇÇ<br>
                                            ‚ãÆ<br>
                                            b‚Çò
                                        </div>
                                        <div class="matrix-bracket">]</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex flex-col items-center">
                            <h3 class="text-lg font-semibold mb-2">Interactive Conversion:</h3>
                            <div id="matrix-form-demo" class="w-full max-w-2xl">
                                <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded mb-4">
                                    <h4 class="font-semibold mb-2">System of Equations:</h4>
                                    <div id="matrix-form-equations" class="font-mono">
                                        <!-- System equations will appear here -->
                                    </div>
                                    <div class="flex justify-center mt-4">
                                        <button id="generate-new-system" class="px-3 py-1 bg-primary text-white rounded">Generate New System</button>
                                    </div>
                                </div>
                                <button id="show-matrix-form" class="px-3 py-1 bg-primary text-white rounded mb-4">Show Matrix Form</button>
                                <div id="matrix-form-result" class="hidden bg-gray-100 dark:bg-gray-700 p-4 rounded">
                                    <h4 class="font-semibold mb-2">Matrix Form:</h4>
                                    <div class="flex justify-center" id="matrix-form-display">
                                        <!-- Matrix form will be displayed here -->
                                    </div>
                                </div>
                                <div class="mt-4 bg-gray-100 dark:bg-gray-700 p-4 rounded">
                                    <h4 class="font-semibold mb-2">What type of solution does this system have?</h4>
                                    <div class="flex flex-col space-y-2">
                                        <label class="flex items-center">
                                            <input type="radio" name="solution-type" value="unique" class="mr-2">
                                            Unique solution
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="solution-type" value="infinite" class="mr-2">
                                            Infinite solutions
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="solution-type" value="none" class="mr-2">
                                            No solution
                                        </label>
                                    </div>
                                    <div class="flex justify-center mt-3">
                                        <button id="check-solution" class="px-3 py-1 bg-primary text-white rounded">Check Answer</button>
                                    </div>
                                    <div id="solution-feedback" class="mt-3 p-2 rounded hidden"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                id: 'matrix-operations',
                title: 'Matrix Operations',
                content: `
                    <div class="flex flex-col space-y-6">
                        <h2 class="text-xl font-bold">Matrix Operations</h2>
                        <p>Matrices can be combined through various operations like addition, subtraction, and multiplication.</p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                                <h3 class="text-lg font-semibold mb-2">Matrix Addition</h3>
                                <p class="mb-2">Add corresponding elements of matrices of the same dimensions.</p>
                                <div id="matrix-addition-demo" class="flex flex-col items-center">
                                    <!-- Matrix addition will be displayed here -->
                                </div>
                            </div>
                            
                            <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                                <h3 class="text-lg font-semibold mb-2">Matrix Multiplication</h3>
                                <p class="mb-2">A more complex operation using rows and columns.</p>
                                <div id="matrix-multiplication-demo" class="flex flex-col items-center">
                                    <!-- Matrix multiplication will be displayed here -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-2">Interactive Matrix Calculator</h3>
                            <div id="matrix-calculator" class="flex flex-col items-center">
                                <div class="flex flex-wrap justify-center gap-4 mb-4">
                                    <div>
                                        <h4 class="font-semibold mb-1 text-center">Matrix A</h4>
                                        <div id="matrix-a-container" class="flex justify-center"></div>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold mb-1 text-center">Matrix B</h4>
                                        <div id="matrix-b-container" class="flex justify-center"></div>
                                    </div>
                                </div>
                                <div class="flex flex-wrap justify-center gap-2 mb-4">
                                    <button id="calc-add" class="px-3 py-1 bg-primary text-white rounded">A + B</button>
                                    <button id="calc-subtract" class="px-3 py-1 bg-primary text-white rounded">A - B</button>
                                    <button id="calc-multiply" class="px-3 py-1 bg-primary text-white rounded">A √ó B</button>
                                    <button id="calc-new" class="px-3 py-1 bg-primary text-white rounded">New Matrices</button>
                                </div>
                                <div id="calc-result" class="hidden w-full">
                                    <h4 class="font-semibold mb-1 text-center">Result</h4>
                                    <div id="result-container" class="flex justify-center"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                id: 'determinants',
                title: 'Determinants',
                content: `
                    <div class="flex flex-col space-y-6">
                        <h2 class="text-xl font-bold">Determinants</h2>
                        <p>The determinant is a scalar value that can be computed from a square matrix and has important geometric and algebraic meanings.</p>
                        
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-2">Geometric Interpretation:</h3>
                            <p>For a 2√ó2 matrix, the determinant represents the area of the parallelogram formed by the column vectors.</p>
                            <p>For a 3√ó3 matrix, it represents the volume of the parallelepiped.</p>
                            
                            <div class="flex justify-center mt-4">
                                <canvas id="determinant-canvas" width="400" height="300" class="bg-white dark:bg-gray-700 rounded-lg shadow-md"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-2">Computing Determinants:</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h4 class="font-medium mb-1">2√ó2 Matrix:</h4>
                                    <div class="flex justify-center items-center">
                                        <div class="det-2x2-formula font-mono">
                                            det(A) = ad - bc where A = 
                                            <div class="inline-block">
                                                [a b]<br>
                                                [c d]
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <h4 class="font-medium mb-1">Properties:</h4>
                                    <ul class="list-disc pl-5">
                                        <li>det(AB) = det(A) √ó det(B)</li>
                                        <li>det(A<sup>T</sup>) = det(A)</li>
                                        <li>det(A<sup>-1</sup>) = 1/det(A)</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex flex-col items-center">
                            <h3 class="text-lg font-semibold mb-2">Interactive Determinant Calculator:</h3>
                            <div id="determinant-calculator" class="w-full max-w-lg">
                                <div class="flex justify-center mb-4">
                                    <div>
                                        <h4 class="font-semibold mb-1 text-center">Matrix</h4>
                                        <div id="det-matrix-container" class="flex justify-center"></div>
                                    </div>
                                </div>
                                <div class="flex justify-center gap-2 mb-4">
                                    <button id="calc-det" class="px-3 py-1 bg-primary text-white rounded">Calculate Determinant</button>
                                    <button id="det-new" class="px-3 py-1 bg-primary text-white rounded">New Matrix</button>
                                </div>
                                <div id="det-result" class="hidden bg-gray-100 dark:bg-gray-700 p-3 rounded text-center">
                                    <!-- Determinant result will be displayed here -->
                                </div>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                id: 'inverse-matrix',
                title: 'Inverse of Matrix',
                content: `
                    <div class="flex flex-col space-y-6">
                        <h2 class="text-xl font-bold">Inverse of a Matrix</h2>
                        <p>The inverse of a square matrix A, denoted A<sup>-1</sup>, is another matrix such that A √ó A<sup>-1</sup> = A<sup>-1</sup> √ó A = I (the identity matrix).</p>
                        
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-2">Properties of Matrix Inverse:</h3>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>A matrix must be square to have an inverse</li>
                                <li>A matrix must have a non-zero determinant to be invertible</li>
                                <li>The inverse of a product: (AB)<sup>-1</sup> = B<sup>-1</sup>A<sup>-1</sup></li>
                                <li>The inverse of an inverse: (A<sup>-1</sup>)<sup>-1</sup> = A</li>
                            </ul>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-2">Gauss-Jordan Method for Finding Inverse:</h3>
                            <p class="mb-2">The Gauss-Jordan elimination can be used to find the inverse by applying row operations to the augmented matrix [A|I] until it becomes [I|A<sup>-1</sup>].</p>
                            
                            <div class="flex flex-col items-center">
                                <div id="inverse-calculator" class="w-full max-w-2xl">
                                    <div class="flex justify-center mb-4">
                                        <div>
                                            <h4 class="font-semibold mb-1 text-center">Matrix A</h4>
                                            <div id="inv-matrix-container" class="flex justify-center"></div>
                                        </div>
                                    </div>
                                    <div class="flex justify-center gap-2 mb-4">
                                        <button id="calc-inverse" class="px-3 py-1 bg-primary text-white rounded">Calculate Inverse</button>
                                        <button id="inv-next-step" class="px-3 py-1 bg-primary text-white rounded">Next Step</button>
                                        <button id="inv-new" class="px-3 py-1 bg-primary text-white rounded">New Matrix</button>
                                    </div>
                                    <div class="flex justify-center mb-4">
                                        <div id="augmented-inverse-matrix" class="flex justify-center">
                                            <!-- Augmented matrix [A|I] will be displayed here -->
                                        </div>
                                    </div>
                                    <div id="inv-explanation" class="bg-gray-100 dark:bg-gray-700 p-3 rounded">
                                        Click "Next Step" to begin finding the inverse using Gauss-Jordan elimination.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                id: 'vectors',
                title: 'Vectors',
                content: `
                    <div class="flex flex-col space-y-6">
                        <h2 class="text-xl font-bold">Vectors</h2>
                        <p>Vectors are quantities with both magnitude and direction, represented as arrows in space or as ordered lists of components.</p>
                        
                        <div class="flex flex-col md:flex-row gap-6">
                            <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg flex-1">
                                <h3 class="text-lg font-semibold mb-2">Vector Representation:</h3>
                                <p>In 2D space, a vector v can be represented as:</p>
                                <div class="flex justify-center my-2 font-mono">
                                    v = [x, y] or v = xi + yj
                                </div>
                                <div class="flex justify-center">
                                    <div class="vector-visuals">
                                        <svg id="vector-svg" width="300" height="300" class="bg-white dark:bg-gray-700 rounded-lg shadow-md"></svg>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg flex-1">
                                <h3 class="text-lg font-semibold mb-2">Vector Properties:</h3>
                                <div class="space-y-3">
                                    <div>
                                        <span class="font-medium">Magnitude:</span> 
                                        <div class="font-mono">|v| = ‚àö(x¬≤ + y¬≤)</div>
                                    </div>
                                    <div>
                                        <span class="font-medium">Unit Vector:</span> 
                                        <div class="font-mono">√ª = v/|v|</div>
                                    </div>
                                    <div>
                                        <span class="font-medium">Dot Product:</span> 
                                        <div class="font-mono">a¬∑b = |a|¬∑|b|¬∑cos(Œ∏) = a‚ÇÅb‚ÇÅ + a‚ÇÇb‚ÇÇ</div>
                                    </div>
                                    <div>
                                        <span class="font-medium">Cross Product (3D):</span>
                                        <div class="font-mono">a√ób = |a|¬∑|b|¬∑sin(Œ∏)¬∑n</div>
                                        <div class="text-sm">where n is unit vector perpendicular to a and b</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-2">Vector Operations:</h3>
                            <div id="vector-operations" class="flex flex-col items-center">
                                <div class="flex flex-wrap justify-center gap-6 mb-4">
                                    <div>
                                        <label class="block font-medium mb-1">Vector u:</label>
                                        <div class="flex gap-2">
                                            <input type="number" id="u-x" placeholder="x" value="3" min="-10" max="10" class="w-16 p-1 border rounded text-black">
                                            <input type="number" id="u-y" placeholder="y" value="1" min="-10" max="10" class="w-16 p-1 border rounded text-black">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block font-medium mb-1">Vector v:</label>
                                        <div class="flex gap-2">
                                            <input type="number" id="v-x" placeholder="x" value="1" min="-10" max="10" class="w-16 p-1 border rounded text-black">
                                            <input type="number" id="v-y" placeholder="y" value="2" min="-10" max="10" class="w-16 p-1 border rounded text-black">
                                        </div>
                                    </div>
                                </div>
                                <div class="flex flex-wrap justify-center gap-2 mb-4">
                                    <button id="vector-add" class="px-3 py-1 bg-primary text-white rounded">u + v</button>
                                    <button id="vector-subtract" class="px-3 py-1 bg-primary text-white rounded">u - v</button>
                                    <button id="vector-dot" class="px-3 py-1 bg-primary text-white rounded">u ¬∑ v</button>
                                    <button id="vector-scale" class="px-3 py-1 bg-primary text-white rounded">Scale u</button>
                                </div>
                                <div class="w-full">
                                    <svg id="vector-operations-svg" width="100%" height="300" viewBox="-10 -10 20 20" class="bg-white dark:bg-gray-700 rounded-lg shadow-md"></svg>
                                </div>
                                <div id="vector-result" class="mt-2 font-mono">
                                    <!-- Vector operation results will be displayed here -->
                                </div>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                id: 'linear-transformations',
                title: 'Linear Transformations',
                content: `
                    <div class="flex flex-col space-y-6">
                        <h2 class="text-xl font-bold">Linear Transformations</h2>
                        <p>Linear transformations are functions that map vectors to vectors while preserving vector addition and scalar multiplication.</p>
                        
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-2">Matrix Representation of Transformations:</h3>
                            <p>Any linear transformation T: R<sup>n</sup> ‚Üí R<sup>m</sup> can be represented by a m√ón matrix A such that T(v) = Av.</p>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                                <div>
                                    <h4 class="font-medium mb-1">Common 2D Transformations:</h4>
                                    <ul class="list-disc pl-5">
                                        <li>
                                            <span class="font-mono">Scaling [s<sub>x</sub> 0; 0 s<sub>y</sub>]</span>
                                        </li>
                                        <li>
                                            <span class="font-mono">Rotation [cos(Œ∏) -sin(Œ∏); sin(Œ∏) cos(Œ∏)]</span>
                                        </li>
                                        <li>
                                            <span class="font-mono">Shear [1 k; 0 1]</span>
                                        </li>
                                        <li>
                                            <span class="font-mono">Reflection [1 0; 0 -1]</span> (across x-axis)
                                        </li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 class="font-medium mb-1">Properties:</h4>
                                    <ul class="list-disc pl-5">
                                        <li>Composition of transformations = matrix multiplication</li>
                                        <li>Inverse transformation = inverse matrix</li>
                                        <li>Identity transformation = identity matrix</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-2">Interactive Transformation Demo:</h3>
                            <div id="transformation-demo" class="flex flex-col items-center">
                                <div class="flex flex-wrap justify-center gap-4 mb-4">
                                    <select id="transform-type" class="p-1 border rounded text-black">
                                        <option value="rotation">Rotation</option>
                                        <option value="scaling">Scaling</option>
                                        <option value="shear">Shear</option>
                                        <option value="reflection">Reflection</option>
                                    </select>
                                    <div id="transform-params" class="flex gap-2">
                                        <input type="range" id="transform-angle" min="0" max="360" value="45" class="w-32">
                                        <span id="transform-angle-value">45¬∞</span>
                                    </div>
                                </div>
                                <div class="w-full max-w-xl">
                                    <svg id="transform-svg" width="100%" height="300" viewBox="-5 -5 10 10" class="bg-white dark:bg-gray-700 rounded-lg shadow-md"></svg>
                                </div>
                                <div id="transform-matrix" class="mt-2 font-mono flex justify-center">
                                    <!-- Transformation matrix will be displayed here -->
                                </div>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                id: 'eigenvalues-eigenvectors',
                title: 'Eigenvalues & Eigenvectors',
                content: `
                    <div class="flex flex-col space-y-6">
                        <h2 class="text-xl font-bold">Eigenvalues and Eigenvectors</h2>
                        <p>Eigenvalues and eigenvectors are special values and vectors associated with a square matrix, representing directions that remain unchanged in orientation by the transformation.</p>
                        
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-2">Definition:</h3>
                            <p>For a square matrix A, if there exists a scalar Œª and a non-zero vector v such that Av = Œªv, then:</p>
                            <ul class="list-disc pl-5 mt-2 space-y-1">
                                <li>Œª is called an <span class="font-semibold">eigenvalue</span> of A</li>
                                <li>v is called an <span class="font-semibold">eigenvector</span> corresponding to Œª</li>
                            </ul>
                            
                            <div class="flex flex-col md:flex-row gap-4 items-center justify-center mt-4">
                                <div class="font-mono text-lg">
                                    Av = Œªv
                                </div>
                                <div class="text-gray-700 dark:text-gray-300">
                                    <span class="italic">or equivalently</span>
                                </div>
                                <div class="font-mono text-lg">
                                    (A - ŒªI)v = 0
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-2">How to Calculate Eigenvalues and Eigenvectors:</h3>
                            <ol class="list-decimal pl-5 space-y-2">
                                <li>
                                    <span class="font-medium">Find the eigenvalues:</span>
                                    <ul class="list-disc pl-5 mt-1">
                                        <li>Set up the characteristic equation: det(A - ŒªI) = 0</li>
                                        <li>Solve for Œª (the eigenvalues)</li>
                                    </ul>
                                </li>
                                <li>
                                    <span class="font-medium">Find the eigenvectors:</span>
                                    <ul class="list-disc pl-5 mt-1">
                                        <li>For each eigenvalue Œª, solve the system (A - ŒªI)v = 0</li>
                                        <li>The solutions form the eigenvectors corresponding to Œª</li>
                                    </ul>
                                </li>
                            </ol>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-2">Example Calculation:</h3>
                            <div id="eigen-example" class="flex flex-col items-center">
                                <div class="flex flex-col md:flex-row gap-6 w-full justify-center mb-4">
                                    <div>
                                        <h4 class="font-semibold mb-1 text-center">Matrix A:</h4>
                                        <div id="eigen-matrix-container" class="font-mono flex justify-center">
                                            <table class="matrix-table" id="eigen-matrix-input">
                                                <tr>
                                                    <td class="matrix-cell">
                                                        <input type="number" class="w-12 p-0 text-center bg-transparent border-none" value="3" data-row="0" data-col="0">
                                                    </td>
                                                    <td class="matrix-cell">
                                                        <input type="number" class="w-12 p-0 text-center bg-transparent border-none" value="1" data-row="0" data-col="1">
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td class="matrix-cell">
                                                        <input type="number" class="w-12 p-0 text-center bg-transparent border-none" value="1" data-row="1" data-col="0">
                                                    </td>
                                                    <td class="matrix-cell">
                                                        <input type="number" class="w-12 p-0 text-center bg-transparent border-none" value="3" data-row="1" data-col="1">
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex justify-center mb-2">
                                    <button id="update-eigen-matrix" class="px-3 py-1 bg-primary text-white rounded">Update Matrix</button>
                                </div>
                                
                                <div class="flex flex-wrap gap-2 justify-center mb-4">
                                    <button id="eigen-step1" class="px-3 py-1 bg-primary text-white rounded">Step 1: Set Up</button>
                                    <button id="eigen-step2" class="px-3 py-1 bg-primary text-white rounded">Step 2: Determinant</button>
                                    <button id="eigen-step3" class="px-3 py-1 bg-primary text-white rounded">Step 3: Eigenvalues</button>
                                    <button id="eigen-step4" class="px-3 py-1 bg-primary text-white rounded">Step 4: Eigenvectors</button>
                                    <button id="eigen-animate" class="px-3 py-1 bg-primary text-white rounded">Visualize</button>
                                    <button id="eigen-new" class="px-3 py-1 bg-primary text-white rounded">New Matrix</button>
                                </div>
                                
                                <div id="eigen-steps" class="bg-gray-100 dark:bg-gray-700 p-3 rounded w-full">
                                    <p>Click "Step 1" to begin calculating eigenvalues and eigenvectors.</p>
                                </div>
                                
                                <div class="mt-4 w-full">
                                    <canvas id="eigen-canvas" width="500" height="300" class="bg-white dark:bg-gray-700 rounded-lg shadow-md mx-auto"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-2">Applications and Significance:</h3>
                            <ul class="list-disc pl-5 space-y-1">
                                <li><span class="font-medium">Principal Component Analysis:</span> Used in data science to reduce dimensionality</li>
                                <li><span class="font-medium">Diagonalization:</span> Matrices with n linearly independent eigenvectors can be diagonalized</li>
                                <li><span class="font-medium">Differential Equations:</span> Used to solve systems of differential equations</li>
                                <li><span class="font-medium">Stability Analysis:</span> Eigenvalues determine stability of dynamic systems</li>
                                <li><span class="font-medium">Quantum Mechanics:</span> Eigenvalues represent observable quantities</li>
                            </ul>
                        </div>
                    </div>
                `
            },
            {
                id: 'stock-portfolio',
                title: 'Stock Portfolio Analysis',
                content: `
                    <div class="flex flex-col space-y-6">
                        <h2 class="text-xl font-bold">Stock Portfolio Analysis with Linear Algebra</h2>
                        <p>Linear algebra provides powerful tools for financial analysis, including tracking how portfolios change in response to market events.</p>
                        
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-2">The Scenario:</h3>
                            <p>You have a portfolio with investments in three tech stocks: Apple, Google, and Microsoft. After a major news event, the stock prices change. We'll use matrices to calculate the impact on your portfolio.</p>
                            
                            <div class="flex flex-col md:flex-row gap-6 w-full justify-center mt-4">
                                <div>
                                    <h4 class="font-semibold mb-1 text-center">Initial Portfolio (Dollars):</h4>
                                    <div id="initial-portfolio" class="font-mono">
                                        <!-- Portfolio will be displayed here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-2">News Event Impact:</h3>
                            <p>A market event occurs, causing the following percentage changes to each stock:</p>
                            
                            <div id="market-impact" class="mt-3 font-mono flex justify-center">
                                <!-- Market impact will be shown here -->
                            </div>
                            
                            <div class="mt-4 flex justify-center">
                                <button id="change-scenario" class="px-3 py-1 bg-primary text-white rounded">Change Scenario</button>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                                <h3 class="text-lg font-semibold mb-2">Matrix Calculation:</h3>
                                <p class="mb-2">We can represent this transformation with matrix multiplication:</p>
                                
                                <div class="flex flex-col items-center mb-3">
                                    <div class="flex flex-wrap items-center justify-center gap-2">
                                        <div id="calculation-step1" class="font-mono">
                                            <!-- Step 1 of calculation -->
                                        </div>
                                    </div>
                                    
                                    <div class="mt-3 text-center">
                                        <div class="font-medium mb-1">Impact Matrix √ó Initial Portfolio:</div>
                                        <div id="calculation-step2" class="font-mono">
                                            <!-- Step 2 of calculation -->
                                        </div>
                                    </div>
                                    
                                    <div class="mt-3 text-center">
                                        <div class="font-medium mb-1">Result = Updated Portfolio:</div>
                                        <div id="calculation-step3" class="font-mono">
                                            <!-- Step 3 of calculation -->
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="flex justify-center mt-4">
                                    <button id="show-calculation" class="px-3 py-1 bg-primary text-white rounded">Show Calculation Steps</button>
                                </div>
                            </div>
                            
                            <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                                <h3 class="text-lg font-semibold mb-2">Portfolio Visualization:</h3>
                                <div class="flex justify-center">
                                    <canvas id="portfolio-chart" width="400" height="300"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-2">Why Use Matrices?</h3>
                            <ul class="list-disc pl-5 space-y-1">
                                <li><span class="font-medium">Efficient representation:</span> Matrices compactly represent complex financial data</li>
                                <li><span class="font-medium">Easy calculation:</span> Matrix operations simplify portfolio calculations</li>
                                <li><span class="font-medium">Scalability:</span> The same approach works for portfolios with many more assets</li>
                                <li><span class="font-medium">Advanced modeling:</span> Enables more complex financial models (covariance, diversification, etc.)</li>
                            </ul>
                            
                            <div class="mt-4">
                                <p class="font-medium">In real-world financial analysis:</p>
                                <p>Financial engineers use much larger matrices representing hundreds or thousands of assets, with complex transformations for risk assessment, optimization, and forecasting.</p>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                id: 'least-squares',
                title: 'Least Squares Regression',
                content: `
                    <div class="flex flex-col space-y-6">
                        <h2 class="text-xl font-bold">Least Squares Regression with Linear Algebra</h2>
                        <p>Least squares regression is a powerful method for finding the line (or curve) that best fits a set of data points, minimizing the sum of squared residuals.</p>
                        
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-2">The Problem:</h3>
                            <p>We have collected data on exercise time (in hours per week) and corresponding weight change (in pounds) for 6 individuals.</p>
                            <p>We want to find the linear relationship between exercise time and weight change: <span class="font-mono">x‚ÇÅ + a‚ÇÅx‚ÇÇ = y</span></p>
                            <p>Where x‚ÇÅ is the y-intercept, a‚ÇÅ is the slope, x‚ÇÇ is the exercise time, and y is the weight change.</p>
                            
                            <div class="overflow-x-auto mt-4">
                                <table class="min-w-full bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600">
                                    <thead>
                                        <tr class="bg-gray-200 dark:bg-gray-800">
                                            <th class="py-2 px-4 border-b">Person</th>
                                            <th class="py-2 px-4 border-b">Exercise Time (x‚ÇÇ) (hours/week)</th>
                                            <th class="py-2 px-4 border-b">Weight Change (y) (pounds)</th>
                                        </tr>
                                    </thead>
                                    <tbody id="data-table">
                                        <!-- Data will be inserted here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                                <h3 class="text-lg font-semibold mb-2">System of Equations:</h3>
                                <p class="mb-3">Each data point gives us one equation, resulting in a system of 6 equations with 2 unknowns:</p>
                                
                                <div id="equation-system" class="font-mono">
                                    <!-- System of equations will be displayed here -->
                                </div>
                                
                                <p class="mt-3">Since we have more equations than unknowns, this system is <span class="font-medium">overdetermined</span> - we can't satisfy all equations exactly. Instead, we find the solution that minimizes the sum of squared errors.</p>
                            </div>
                            
                            <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                                <h3 class="text-lg font-semibold mb-2">Data Visualization:</h3>
                                <div class="flex justify-center">
                                    <canvas id="regression-chart" width="400" height="300" class="bg-white dark:bg-gray-700 rounded"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-2">Matrix Formulation:</h3>
                            <p>We can express our system in matrix form as <span class="font-mono">XŒ≤ = y</span>, where:</p>
                            
                            <div class="flex flex-wrap items-center justify-center gap-4 my-4">
                                <div id="matrix-X" class="font-mono">
                                    <!-- X matrix will be displayed here -->
                                </div>
                                <div id="matrix-beta" class="font-mono">
                                    <!-- Œ≤ matrix will be displayed here -->
                                </div>
                                <div class="text-2xl">=</div>
                                <div id="matrix-y" class="font-mono">
                                    <!-- y matrix will be displayed here -->
                                </div>
                            </div>
                            
                            <p class="mt-2">The least squares solution is given by: <span class="font-mono">Œ≤ = (X<sup>T</sup>X)<sup>-1</sup>X<sup>T</sup>y</span></p>
                            
                            <div class="flex justify-center mt-4">
                                <button id="show-ls-steps" class="px-3 py-1 bg-primary text-white rounded">Show Calculation Steps</button>
                            </div>
                        </div>
                        
                        <div id="ls-steps-container" class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg hidden">
                            <h3 class="text-lg font-semibold mb-2">Least Squares Calculation Steps:</h3>
                            
                            <div class="space-y-4 font-mono">
                                <div>
                                    <h4 class="font-medium mb-1">Step 1: Calculate X<sup>T</sup> (Transpose of X)</h4>
                                    <div id="step-xt" class="flex justify-center">
                                        <!-- X transpose will be displayed here -->
                                    </div>
                                </div>
                                
                                <div>
                                    <h4 class="font-medium mb-1">Step 2: Calculate X<sup>T</sup>X</h4>
                                    <div id="step-xtx" class="flex justify-center">
                                        <!-- X^T X will be displayed here -->
                                    </div>
                                </div>
                                
                                <div>
                                    <h4 class="font-medium mb-1">Step 3: Calculate (X<sup>T</sup>X)<sup>-1</sup> (Inverse)</h4>
                                    <div id="step-xtx-inv" class="flex justify-center">
                                        <!-- (X^T X)^-1 will be displayed here -->
                                    </div>
                                </div>
                                
                                <div>
                                    <h4 class="font-medium mb-1">Step 4: Calculate X<sup>T</sup>y</h4>
                                    <div id="step-xty" class="flex justify-center">
                                        <!-- X^T y will be displayed here -->
                                    </div>
                                </div>
                                
                                <div>
                                    <h4 class="font-medium mb-1">Step 5: Calculate Œ≤ = (X<sup>T</sup>X)<sup>-1</sup>X<sup>T</sup>y</h4>
                                    <div id="step-beta" class="flex justify-center">
                                        <!-- Final Œ≤ will be displayed here -->
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-6 p-3 bg-green-100 dark:bg-green-900 rounded">
                                <h4 class="font-medium mb-1">Final Result:</h4>
                                <div id="regression-equation" class="text-center text-lg">
                                    <!-- Final equation will be displayed here -->
                                </div>
                                <p class="mt-2 text-center" id="equation-interpretation">
                                    <!-- Interpretation will be displayed here -->
                                </p>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-2">Applications and Benefits:</h3>
                            <ul class="list-disc pl-5 space-y-1">
                                <li><span class="font-medium">Scientific modeling:</span> Finding relationships between variables in experimental data</li>
                                <li><span class="font-medium">Economics:</span> Analyzing trends and making predictions based on historical data</li>
                                <li><span class="font-medium">Machine Learning:</span> Linear regression is a fundamental supervised learning algorithm</li>
                                <li><span class="font-medium">Quality control:</span> Modeling process variables and outcomes</li>
                                <li><span class="font-medium">Computer vision:</span> Fitting lines and curves to detected features</li>
                            </ul>
                        </div>
                    </div>
                `
            }
        ];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            initApp();
        });

        // Check for dark mode preference
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Application state
        let currentSlideIndex = 0;

        // Initialize the application
        function initApp() {
            populateTopicList();
            populateSlides();
            initNavigation();
            showSlide(0);
            
            // Initialize the theme toggle
            const themeToggle = document.getElementById('theme-toggle');
            themeToggle.addEventListener('click', () => {
                document.documentElement.classList.toggle('dark');
            });
        }

        // Populate the topic list in the sidebar
        function populateTopicList() {
            const topicList = document.getElementById('topic-list');
            slides.forEach((slide, index) => {
                const li = document.createElement('li');
                li.innerHTML = `<button class="w-full text-left px-2 py-1 rounded hover:bg-gray-200 dark:hover:bg-gray-800 topic-btn" data-index="${index}">${slide.title}</button>`;
                topicList.appendChild(li);
            });

            // Add click event listeners to topic buttons
            document.querySelectorAll('.topic-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const index = parseInt(btn.dataset.index);
                    showSlide(index);
                });
            });
        }

        // Populate the slides in the main content area
        function populateSlides() {
            const mainContent = document.getElementById('main-content');
            slides.forEach((slide, index) => {
                const slideDiv = document.createElement('div');
                slideDiv.className = 'slide';
                slideDiv.id = `slide-${slide.id}`;
                slideDiv.innerHTML = slide.content;
                mainContent.appendChild(slideDiv);
            });
        }

        // Initialize navigation controls
        function initNavigation() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const slideIndicator = document.getElementById('slide-indicator');

            prevBtn.addEventListener('click', () => {
                if (currentSlideIndex > 0) {
                    showSlide(currentSlideIndex - 1);
                }
            });

            nextBtn.addEventListener('click', () => {
                if (currentSlideIndex < slides.length - 1) {
                    showSlide(currentSlideIndex + 1);
                }
            });

            // Update slide indicator
            updateSlideIndicator();
        }

        // Show a specific slide
        function showSlide(index) {
            // Hide all slides
            document.querySelectorAll('.slide').forEach(slide => {
                slide.classList.remove('active');
            });

            // Show the selected slide
            const slideToShow = document.getElementById(`slide-${slides[index].id}`);
            slideToShow.classList.add('active');

            // Update active topic in sidebar
            document.querySelectorAll('.topic-btn').forEach((btn, idx) => {
                if (idx === index) {
                    btn.classList.add('bg-gray-200', 'dark:bg-gray-800', 'font-medium');
                } else {
                    btn.classList.remove('bg-gray-200', 'dark:bg-gray-800', 'font-medium');
                }
            });

            // Update current slide index
            currentSlideIndex = index;
            updateSlideIndicator();

            // Initialize specific slide content
            initSlideContent(index);
        }

        // Update the slide indicator text
        function updateSlideIndicator() {
            const slideIndicator = document.getElementById('slide-indicator');
            slideIndicator.textContent = `${currentSlideIndex + 1} / ${slides.length}`;

            // Update prev/next button states
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');

            prevBtn.disabled = currentSlideIndex === 0;
            nextBtn.disabled = currentSlideIndex === slides.length - 1;

            if (prevBtn.disabled) {
                prevBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                prevBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }

            if (nextBtn.disabled) {
                nextBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                nextBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        // Initialize slide-specific content
        function initSlideContent(index) {
            const slideId = slides[index].id;
            
            switch (slideId) {
                case 'linear-systems':
                    initLinearSystemsDemo();
                    break;
                case 'gauss-jordan':
                    initGaussJordanDemo();
                    break;
                case 'matrix-form':
                    initMatrixFormDemo();
                    break;
                case 'matrix-operations':
                    initMatrixOperationsDemo();
                    break;
                case 'determinants':
                    initDeterminantsDemo();
                    break;
                case 'inverse-matrix':
                    initInverseMatrixDemo();
                    break;
                case 'vectors':
                    initVectorsDemo();
                    break;
                case 'linear-transformations':
                    initTransformationsDemo();
                    break;
                case 'eigenvalues-eigenvectors':
                    initEigenDemo();
                    break;
                case 'stock-portfolio':
                    initStockPortfolioDemo();
                    break;
                case 'least-squares':
                    initLeastSquaresDemo();
                    break;
            }
        }

        // Utility functions
        function createMatrix(rows, cols, fill = null) {
            return Array(rows).fill().map(() => 
                Array(cols).fill().map(() => fill === null ? Math.floor(Math.random() * 7) - 3 : fill)
            );
        }

        function renderMatrix(matrix, container, isAugmented = false, augmentedCol = -1) {
            container.innerHTML = '';
            
            const table = document.createElement('table');
            table.className = 'matrix-table';
            
            for (let i = 0; i < matrix.length; i++) {
                const row = document.createElement('tr');
                
                for (let j = 0; j < matrix[i].length; j++) {
                    const cell = document.createElement('td');
                    cell.className = 'matrix-cell';
                    
                    // Add separator for augmented matrix
                    if (isAugmented && j === augmentedCol) {
                        cell.style.borderRight = '2px solid #5D5CDE';
                    }
                    
                    cell.textContent = matrix[i][j];
                    row.appendChild(cell);
                }
                
                table.appendChild(row);
            }
            
            container.appendChild(table);
            return table;
        }

        function renderEditableMatrix(matrix, container, onEdit = null) {
            container.innerHTML = '';
            
            const table = document.createElement('table');
            table.className = 'matrix-table';
            
            for (let i = 0; i < matrix.length; i++) {
                const row = document.createElement('tr');
                
                for (let j = 0; j < matrix[i].length; j++) {
                    const cell = document.createElement('td');
                    cell.className = 'matrix-cell';
                    
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.className = 'w-10 p-0 text-center bg-transparent border-none';
                    input.value = matrix[i][j];
                    input.dataset.row = i;
                    input.dataset.col = j;
                    
                    if (onEdit) {
                        input.addEventListener('change', (e) => {
                            const r = parseInt(e.target.dataset.row);
                            const c = parseInt(e.target.dataset.col);
                            const val = parseInt(e.target.value) || 0;
                            onEdit(r, c, val);
                        });
                    }
                    
                    cell.appendChild(input);
                    row.appendChild(cell);
                }
                
                table.appendChild(row);
            }
            
            container.appendChild(table);
            return table;
        }

        // Linear Systems Demo
        function initLinearSystemsDemo() {
            const systemEquations = document.getElementById('system-equations');
            const canvas = document.getElementById('linear-system-canvas');
            const ctx = canvas.getContext('2d');
            const newSystemBtn = document.getElementById('new-system');
            
            let coefficients = [];
            let constants = [];
            
            function generateSystem() {
                // Generate a system of 2 equations in 2 variables
                coefficients = [
                    [Math.floor(Math.random() * 5) - 2, Math.floor(Math.random() * 5) - 2],
                    [Math.floor(Math.random() * 5) - 2, Math.floor(Math.random() * 5) - 2]
                ];
                
                // Ensure we don't have zero coefficients
                if (coefficients[0][0] === 0) coefficients[0][0] = 1;
                if (coefficients[0][1] === 0) coefficients[0][1] = 1;
                if (coefficients[1][0] === 0) coefficients[1][0] = 1;
                if (coefficients[1][1] === 0) coefficients[1][1] = 1;
                
                constants = [
                    Math.floor(Math.random() * 10) - 5,
                    Math.floor(Math.random() * 10) - 5
                ];
                
                displaySystem();
                drawGraph();
            }
            
            function displaySystem() {
                systemEquations.innerHTML = '';
                
                for (let i = 0; i < 2; i++) {
                    const equation = document.createElement('div');
                    equation.className = 'system-equation';
                    
                    let eqText = '';
                    if (coefficients[i][0] === 1) {
                        eqText += 'x';
                    } else if (coefficients[i][0] === -1) {
                        eqText += '-x';
                    } else {
                        eqText += coefficients[i][0] + 'x';
                    }
                    
                    if (coefficients[i][1] > 0) {
                        eqText += ' + ';
                        if (coefficients[i][1] === 1) {
                            eqText += 'y';
                        } else {
                            eqText += coefficients[i][1] + 'y';
                        }
                    } else if (coefficients[i][1] < 0) {
                        eqText += ' - ';
                        if (coefficients[i][1] === -1) {
                            eqText += 'y';
                        } else {
                            eqText += Math.abs(coefficients[i][1]) + 'y';
                        }
                    }
                    
                    eqText += ' = ' + constants[i];
                    
                    equation.textContent = eqText;
                    systemEquations.appendChild(equation);
                }
            }
            
            function drawGraph() {
                const width = canvas.width;
                const height = canvas.height;
                const scale = 30;
                const offsetX = width / 2;
                const offsetY = height / 2;
                
                // Clear canvas
                ctx.clearRect(0, 0, width, height);
                
                // Draw grid
                ctx.strokeStyle = '#ddd';
                ctx.lineWidth = 1;
                
                // Vertical grid lines
                for (let x = -offsetX; x < width; x += scale) {
                    ctx.beginPath();
                    ctx.moveTo(offsetX + x, 0);
                    ctx.lineTo(offsetX + x, height);
                    ctx.stroke();
                }
                
                // Horizontal grid lines
                for (let y = -offsetY; y < height; y += scale) {
                    ctx.beginPath();
                    ctx.moveTo(0, offsetY + y);
                    ctx.lineTo(width, offsetY + y);
                    ctx.stroke();
                }
                
                // Draw axes
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                
                // x-axis
                ctx.beginPath();
                ctx.moveTo(0, offsetY);
                ctx.lineTo(width, offsetY);
                ctx.stroke();
                
                // y-axis
                ctx.beginPath();
                ctx.moveTo(offsetX, 0);
                ctx.lineTo(offsetX, height);
                ctx.stroke();
                
                // Draw lines representing the equations
                for (let i = 0; i < 2; i++) {
                    const a = coefficients[i][0];
                    const b = coefficients[i][1];
                    const c = constants[i];
                    
                    // Calculate two points for drawing the line
                    let x1, y1, x2, y2;
                    
                    if (b === 0) {
                        // Vertical line
                        const x = c / a;
                        x1 = x2 = x;
                        y1 = -10;
                        y2 = 10;
                    } else {
                        // General case
                        x1 = -10;
                        y1 = (c - a * x1) / b;
                        x2 = 10;
                        y2 = (c - a * x2) / b;
                    }
                    
                    ctx.strokeStyle = i === 0 ? '#5D5CDE' : '#E53E3E';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(offsetX + x1 * scale, offsetY - y1 * scale);
                    ctx.lineTo(offsetX + x2 * scale, offsetY - y2 * scale);
                    ctx.stroke();
                    
                    // Draw equation label
                    ctx.fillStyle = i === 0 ? '#5D5CDE' : '#E53E3E';
                    ctx.font = '14px Arial';
                    const labelX = offsetX + (x1 + 1) * scale;
                    const labelY = offsetY - (y1 + 1) * scale;
                    ctx.fillText(`Eq ${i+1}`, labelX, labelY);
                }
                
                // Check for solution
                const det = coefficients[0][0] * coefficients[1][1] - coefficients[0][1] * coefficients[1][0];
                
                if (Math.abs(det) < 0.00001) {
                    // Lines are parallel or coincident (no unique solution)
                    const ratio1 = coefficients[0][0] / coefficients[1][0];
                    const ratio2 = coefficients[0][1] / coefficients[1][1];
                    const ratio3 = constants[0] / constants[1];
                    
                    if (Math.abs(ratio1 - ratio2) < 0.00001 && Math.abs(ratio1 - ratio3) < 0.00001) {
                        // Coincident lines (infinite solutions)
                        ctx.fillStyle = '#38A169';
                        ctx.font = 'bold 16px Arial';
                        ctx.fillText('Infinitely many solutions (coincident lines)', 20, 30);
                    } else {
                        // Parallel lines (no solution)
                        ctx.fillStyle = '#E53E3E';
                        ctx.font = 'bold 16px Arial';
                        ctx.fillText('No solution (parallel lines)', 20, 30);
                    }
                } else {
                    // Unique solution
                    const detX = constants[0] * coefficients[1][1] - constants[1] * coefficients[0][1];
                    const detY = coefficients[0][0] * constants[1] - coefficients[1][0] * constants[0];
                    
                    const x = detX / det;
                    const y = detY / det;
                    
                    // Draw intersection point
                    ctx.fillStyle = '#38A169';
                    ctx.beginPath();
                    ctx.arc(offsetX + x * scale, offsetY - y * scale, 6, 0, 2 * Math.PI);
                    ctx.fill();
                    
                    // Label the solution
                    ctx.fillStyle = '#38A169';
                    ctx.font = 'bold 16px Arial';
                    ctx.fillText(`Solution: (${x.toFixed(2)}, ${y.toFixed(2)})`, 20, 30);
                }
            }
            
            // Event listener for new system button
            newSystemBtn.addEventListener('click', generateSystem);
            
            // Initialize with a random system
            generateSystem();
        }

        // Gauss-Jordan Elimination Demo
        function initGaussJordanDemo() {
            const matrixContainer = document.getElementById('augmented-matrix');
            const gjResetBtn = document.getElementById('gj-reset');
            const gjNextStepBtn = document.getElementById('gj-next-step');
            const gjAutoBtn = document.getElementById('gj-auto');
            const gjExplanation = document.getElementById('gj-explanation');
            
            let matrix = [];
            let currentStep = 0;
            let operationHistory = [];
            
            function createRandomMatrix() {
                // Create a 3x4 augmented matrix (3 equations with 3 variables)
                matrix = [];
                for (let i = 0; i < 3; i++) {
                    const row = [];
                    for (let j = 0; j < 4; j++) {
                        row.push(Math.floor(Math.random() * 7) - 3);
                    }
                    matrix.push(row);
                }
                
                // Ensure we don't have all zeros in a row
                for (let i = 0; i < 3; i++) {
                    if (matrix[i][0] === 0 && matrix[i][1] === 0 && matrix[i][2] === 0) {
                        matrix[i][Math.floor(Math.random() * 3)] = Math.floor(Math.random() * 3) + 1;
                    }
                }
                
                currentStep = 0;
                operationHistory = [];
                renderAugmentedMatrix();
                gjExplanation.textContent = "Click 'Next Step' to begin Gauss-Jordan elimination.";
            }
            
            function renderAugmentedMatrix() {
                renderMatrix(matrix, matrixContainer, true, 3);
            }
            
            function nextStep() {
                if (isInRowEchelonForm() && isInReducedRowEchelonForm()) {
                    gjExplanation.textContent = "Matrix is in Reduced Row Echelon Form (RREF). Elimination complete!";
                    return;
                }
                
                let operation = '';
                
                // Forward elimination phase
                if (!isInRowEchelonForm()) {
                    for (let col = 0; col < 3; col++) {
                        // Find pivot
                        let pivotRow = -1;
                        for (let row = col; row < 3; row++) {
                            if (matrix[row][col] !== 0) {
                                pivotRow = row;
                                break;
                            }
                        }
                        
                        if (pivotRow === -1) continue; // No pivot in this column
                        
                        // Swap if necessary
                        if (pivotRow !== col) {
                            [matrix[col], matrix[pivotRow]] = [matrix[pivotRow], matrix[col]];
                            operation = `Swap rows ${pivotRow + 1} and ${col + 1}`;
                            break;
                        }
                        
                        // Eliminate below pivot
                        let eliminated = false;
                        for (let row = col + 1; row < 3; row++) {
                            if (matrix[row][col] !== 0) {
                                const factor = matrix[row][col] / matrix[col][col];
                                for (let j = col; j < 4; j++) {
                                    matrix[row][j] -= factor * matrix[col][j];
                                    // Clean up any floating point errors
                                    matrix[row][j] = Math.round(matrix[row][j] * 1000) / 1000;
                                }
                                operation = `R${row + 1} = R${row + 1} - ${factor.toFixed(2)} √ó R${col + 1}`;
                                eliminated = true;
                                break;
                            }
                        }
                        
                        if (eliminated) break;
                    }
                }
                // Back substitution phase
                else if (!isInReducedRowEchelonForm()) {
                    // Scale pivot rows to 1
                    for (let row = 0; row < 3; row++) {
                        let pivotCol = -1;
                        for (let col = 0; col < 3; col++) {
                            if (matrix[row][col] !== 0) {
                                pivotCol = col;
                                break;
                            }
                        }
                        
                        if (pivotCol === -1) continue; // No pivot in this row
                        
                        if (matrix[row][pivotCol] !== 1) {
                            const factor = 1 / matrix[row][pivotCol];
                            for (let j = pivotCol; j < 4; j++) {
                                matrix[row][j] *= factor;
                                // Clean up any floating point errors
                                matrix[row][j] = Math.round(matrix[row][j] * 1000) / 1000;
                            }
                            operation = `R${row + 1} = ${factor.toFixed(2)} √ó R${row + 1}`;
                            break;
                        }
                        
                        // Eliminate above pivot
                        let eliminated = false;
                        for (let r = row - 1; r >= 0; r--) {
                            if (matrix[r][pivotCol] !== 0) {
                                const factor = matrix[r][pivotCol];
                                for (let j = pivotCol; j < 4; j++) {
                                    matrix[r][j] -= factor * matrix[row][j];
                                    // Clean up any floating point errors
                                    matrix[r][j] = Math.round(matrix[r][j] * 1000) / 1000;
                                }
                                operation = `R${r + 1} = R${r + 1} - ${factor.toFixed(2)} √ó R${row + 1}`;
                                eliminated = true;
                                break;
                            }
                        }
                        
                        if (eliminated) break;
                    }
                }
                
                currentStep++;
                operationHistory.push(operation);
                renderAugmentedMatrix();
                gjExplanation.textContent = `Step ${currentStep}: ${operation}`;
                
                // Check if we're done
                if (isInRowEchelonForm() && isInReducedRowEchelonForm()) {
                    gjExplanation.textContent += ". Matrix is now in Reduced Row Echelon Form (RREF). Elimination complete!";
                }
            }
            
            function isInRowEchelonForm() {
                // Check if matrix is in row echelon form
                let lastPivotCol = -1;
                
                for (let row = 0; row < 3; row++) {
                    let pivotCol = -1;
                    for (let col = 0; col < 3; col++) {
                        if (matrix[row][col] !== 0) {
                            pivotCol = col;
                            break;
                        }
                    }
                    
                    if (pivotCol === -1) { // All zeros row
                        continue;
                    }
                    
                    if (pivotCol <= lastPivotCol) {
                        return false;
                    }
                    
                    lastPivotCol = pivotCol;
                }
                
                return true;
            }
            
            function isInReducedRowEchelonForm() {
                if (!isInRowEchelonForm()) return false;
                
                // Check if each pivot is 1 and is the only non-zero entry in its column
                for (let row = 0; row < 3; row++) {
                    let pivotCol = -1;
                    for (let col = 0; col < 3; col++) {
                        if (matrix[row][col] !== 0) {
                            pivotCol = col;
                            break;
                        }
                    }
                    
                    if (pivotCol === -1) continue; // All zeros row
                    
                    if (matrix[row][pivotCol] !== 1) {
                        return false;
                    }
                    
                    // Check if pivot column has zeros elsewhere
                    for (let r = 0; r < 3; r++) {
                        if (r !== row && matrix[r][pivotCol] !== 0) {
                            return false;
                        }
                    }
                }
                
                return true;
            }
            
            function autoSolve() {
                const interval = setInterval(() => {
                    if (isInRowEchelonForm() && isInReducedRowEchelonForm()) {
                        clearInterval(interval);
                        return;
                    }
                    nextStep();
                }, 800);
            }
            
            // Event listeners
            gjResetBtn.addEventListener('click', createRandomMatrix);
            gjNextStepBtn.addEventListener('click', nextStep);
            gjAutoBtn.addEventListener('click', autoSolve);
            
            // Initialize with a random matrix
            createRandomMatrix();
        }

        // Matrix Form Demo
        function initMatrixFormDemo() {
            const matrixFormEquations = document.getElementById('matrix-form-equations');
            const showMatrixFormBtn = document.getElementById('show-matrix-form');
            const matrixFormResult = document.getElementById('matrix-form-result');
            const matrixFormDisplay = document.getElementById('matrix-form-display');
            const generateNewSystemBtn = document.getElementById('generate-new-system');
            const checkSolutionBtn = document.getElementById('check-solution');
            const solutionFeedback = document.getElementById('solution-feedback');
            
            let coefficients = [];
            let constants = [];
            let solutionType = "unique"; // Default value
            
            function generateSystem() {
                // Generate a system of 3 equations in 3 variables
                coefficients = [];
                constants = [];
                
                // Decide which type of system to generate
                const typeRandom = Math.random();
                if (typeRandom < 0.33) {
                    // Unique solution
                    generateUniqueSystem();
                    solutionType = "unique";
                } else if (typeRandom < 0.66) {
                    // No solution
                    generateNoSolutionSystem();
                    solutionType = "none";
                } else {
                    // Infinite solutions
                    generateInfiniteSolutionsSystem();
                    solutionType = "infinite";
                }
                
                displaySystem();
                // Clear previous results
                matrixFormResult.classList.add('hidden');
                solutionFeedback.classList.add('hidden');
                document.querySelectorAll('input[name="solution-type"]').forEach(radio => {
                    radio.checked = false;
                });
            }
            
            function generateUniqueSystem() {
                // Create a system with a unique solution
                for (let i = 0; i < 3; i++) {
                    const row = [];
                    for (let j = 0; j < 3; j++) {
                        row.push(Math.floor(Math.random() * 7) - 3);
                    }
                    coefficients.push(row);
                    constants.push(Math.floor(Math.random() * 10) - 5);
                }
                
                // Ensure determinant is not zero (to guarantee a unique solution)
                const det = determinant3x3(coefficients);
                if (Math.abs(det) < 0.001) {
                    // Try again
                    generateUniqueSystem();
                }
            }
            
            function generateNoSolutionSystem() {
                // Create a system with no solution (inconsistent system)
                // First, generate two non-parallel equations
                for (let i = 0; i < 2; i++) {
                    const row = [];
                    for (let j = 0; j < 3; j++) {
                        row.push(Math.floor(Math.random() * 7) - 3);
                    }
                    coefficients.push(row);
                    constants.push(Math.floor(Math.random() * 10) - 5);
                }
                
                // Make the third row a multiple of the first row but with a different constant
                const factor = Math.floor(Math.random() * 3) + 1;
                const row = coefficients[0].map(coef => coef * factor);
                coefficients.push(row);
                
                // Ensure inconsistency by setting a different constant
                constants.push(constants[0] * factor + (Math.random() > 0.5 ? 1 : -1));
            }
            
            function generateInfiniteSolutionsSystem() {
                // Create a system with infinite solutions (dependent equations)
                // First, generate two non-parallel equations
                for (let i = 0; i < 2; i++) {
                    const row = [];
                    for (let j = 0; j < 3; j++) {
                        row.push(Math.floor(Math.random() * 7) - 3);
                    }
                    coefficients.push(row);
                    constants.push(Math.floor(Math.random() * 10) - 5);
                }
                
                // Make the third row a multiple of the first row with the corresponding constant
                const factor = Math.floor(Math.random() * 3) + 1;
                const row = coefficients[0].map(coef => coef * factor);
                coefficients.push(row);
                constants.push(constants[0] * factor);
            }
            
            function determinant3x3(matrix) {
                return (
                    matrix[0][0] * (matrix[1][1] * matrix[2][2] - matrix[1][2] * matrix[2][1]) -
                    matrix[0][1] * (matrix[1][0] * matrix[2][2] - matrix[1][2] * matrix[2][0]) +
                    matrix[0][2] * (matrix[1][0] * matrix[2][1] - matrix[1][1] * matrix[2][0])
                );
            }
            
            function displaySystem() {
                matrixFormEquations.innerHTML = '';
                
                for (let i = 0; i < 3; i++) {
                    const equation = document.createElement('div');
                    equation.className = 'mb-2';
                    
                    let eqText = '';
                    for (let j = 0; j < 3; j++) {
                        if (j > 0) {
                            eqText += coefficients[i][j] >= 0 ? ' + ' : ' - ';
                        } else if (coefficients[i][j] < 0) {
                            eqText += '-';
                        }
                        
                        const absCoeff = Math.abs(coefficients[i][j]);
                        if (absCoeff === 0) {
                            continue;
                        } else if (absCoeff === 1) {
                            eqText += `x${j+1}`;
                        } else {
                            eqText += `${absCoeff}x${j+1}`;
                        }
                    }
                    
                    eqText += ` = ${constants[i]}`;
                    
                    equation.textContent = eqText;
                    matrixFormEquations.appendChild(equation);
                }
            }
            
            function showMatrixForm() {
                matrixFormResult.classList.remove('hidden');
                
                matrixFormDisplay.innerHTML = '';
                
                // Create matrix representation: A √ó x = b
                const matrixA = document.createElement('div');
                matrixA.className = 'matrix-container';
                matrixA.innerHTML = `
                    <div class="text-3xl inline-block align-middle mx-1">[</div>
                    <div class="inline-block align-middle">
                        ${coefficients.map(row => row.join(' ')).join('<br>')}
                    </div>
                    <div class="text-3xl inline-block align-middle mx-1">]</div>
                `;
                
                const matrixX = document.createElement('div');
                matrixX.className = 'matrix-container';
                matrixX.innerHTML = `
                    <div class="text-3xl inline-block align-middle mx-1">[</div>
                    <div class="inline-block align-middle">
                        x<sub>1</sub><br>
                        x<sub>2</sub><br>
                        x<sub>3</sub>
                    </div>
                    <div class="text-3xl inline-block align-middle mx-1">]</div>
                `;
                
                const matrixB = document.createElement('div');
                matrixB.className = 'matrix-container';
                matrixB.innerHTML = `
                    <div class="text-3xl inline-block align-middle mx-1">[</div>
                    <div class="inline-block align-middle">
                        ${constants.join('<br>')}
                    </div>
                    <div class="text-3xl inline-block align-middle mx-1">]</div>
                `;
                
                const equals = document.createElement('div');
                equals.className = 'mx-2 text-2xl';
                equals.innerHTML = '=';
                
                const container = document.createElement('div');
                container.className = 'flex items-center justify-center flex-wrap';
                container.appendChild(matrixA);
                container.appendChild(matrixX);
                container.appendChild(equals);
                container.appendChild(matrixB);
                
                matrixFormDisplay.appendChild(container);
            }
            
            function checkSolution() {
                const selectedAnswer = document.querySelector('input[name="solution-type"]:checked');
                
                if (!selectedAnswer) {
                    solutionFeedback.textContent = "Please select an answer first.";
                    solutionFeedback.className = "mt-3 p-2 rounded bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";
                    solutionFeedback.classList.remove('hidden');
                    return;
                }
                
                const userAnswer = selectedAnswer.value;
                
                if (userAnswer === solutionType) {
                    solutionFeedback.textContent = "Correct! You identified the solution type correctly.";
                    solutionFeedback.className = "mt-3 p-2 rounded bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";
                } else {
                    let correctAnswerText = "";
                    switch(solutionType) {
                        case "unique":
                            correctAnswerText = "a unique solution";
                            break;
                        case "infinite":
                            correctAnswerText = "infinitely many solutions";
                            break;
                        case "none":
                            correctAnswerText = "no solutions";
                            break;
                    }
                    solutionFeedback.textContent = `Incorrect. This system actually has ${correctAnswerText}.`;
                    solutionFeedback.className = "mt-3 p-2 rounded bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";
                }
                
                solutionFeedback.classList.remove('hidden');
            }
            
            // Event listeners
            showMatrixFormBtn.addEventListener('click', showMatrixForm);
            generateNewSystemBtn.addEventListener('click', generateSystem);
            checkSolutionBtn.addEventListener('click', checkSolution);
            
            // Initialize with a random system
            generateSystem();
        }

        // Matrix Operations Demo
        function initMatrixOperationsDemo() {
            const matrixAdditionDemo = document.getElementById('matrix-addition-demo');
            const matrixMultiplicationDemo = document.getElementById('matrix-multiplication-demo');
            const matrixAContainer = document.getElementById('matrix-a-container');
            const matrixBContainer = document.getElementById('matrix-b-container');
            const resultContainer = document.getElementById('result-container');
            const calcResultDiv = document.getElementById('calc-result');
            
            const calcAddBtn = document.getElementById('calc-add');
            const calcSubtractBtn = document.getElementById('calc-subtract');
            const calcMultiplyBtn = document.getElementById('calc-multiply');
            const calcNewBtn = document.getElementById('calc-new');
            
            let matrixA = [];
            let matrixB = [];
            
            function createMatrices() {
                // Create two 2x2 matrices
                matrixA = createMatrix(2, 2);
                matrixB = createMatrix(2, 2);
                
                // Display static addition example
                const a1 = createMatrix(2, 2);
                const b1 = createMatrix(2, 2);
                const sum = a1.map((row, i) => 
                    row.map((val, j) => val + b1[i][j])
                );
                
                matrixAdditionDemo.innerHTML = `
                    <div class="flex items-center justify-center flex-wrap">
                        <div class="flex justify-center">
                            ${renderMatrixHTML(a1)}
                        </div>
                        <div class="mx-2 text-xl">+</div>
                        <div class="flex justify-center">
                            ${renderMatrixHTML(b1)}
                        </div>
                        <div class="mx-2 text-xl">=</div>
                        <div class="flex justify-center">
                            ${renderMatrixHTML(sum)}
                        </div>
                    </div>
                `;
                
                // Display static multiplication example
                const a2 = createMatrix(2, 2);
                const b2 = createMatrix(2, 2);
                const product = [
                    [
                        a2[0][0] * b2[0][0] + a2[0][1] * b2[1][0],
                        a2[0][0] * b2[0][1] + a2[0][1] * b2[1][1]
                    ],
                    [
                        a2[1][0] * b2[0][0] + a2[1][1] * b2[1][0],
                        a2[1][0] * b2[0][1] + a2[1][1] * b2[1][1]
                    ]
                ];
                
                matrixMultiplicationDemo.innerHTML = `
                    <div class="flex items-center justify-center flex-wrap">
                        <div class="flex justify-center">
                            ${renderMatrixHTML(a2)}
                        </div>
                        <div class="mx-2 text-xl">√ó</div>
                        <div class="flex justify-center">
                            ${renderMatrixHTML(b2)}
                        </div>
                        <div class="mx-2 text-xl">=</div>
                        <div class="flex justify-center">
                            ${renderMatrixHTML(product)}
                        </div>
                    </div>
                `;
                
                // Render interactive matrices
                renderMatrix(matrixA, matrixAContainer);
                renderMatrix(matrixB, matrixBContainer);
                
                // Reset result
                calcResultDiv.classList.add('hidden');
            }
            
            function renderMatrixHTML(matrix) {
                return `
                    <table class="matrix-table">
                        ${matrix.map(row => 
                            `<tr>${row.map(cell => 
                                `<td class="matrix-cell">${cell}</td>`
                            ).join('')}</tr>`
                        ).join('')}
                    </table>
                `;
            }
            
            function addMatrices() {
                const result = matrixA.map((row, i) => 
                    row.map((val, j) => val + matrixB[i][j])
                );
                
                displayResult(result, '+');
            }
            
            function subtractMatrices() {
                const result = matrixA.map((row, i) => 
                    row.map((val, j) => val - matrixB[i][j])
                );
                
                displayResult(result, '-');
            }
            
            function multiplyMatrices() {
                // For 2x2 matrices
                const result = [
                    [
                        matrixA[0][0] * matrixB[0][0] + matrixA[0][1] * matrixB[1][0],
                        matrixA[0][0] * matrixB[0][1] + matrixA[0][1] * matrixB[1][1]
                    ],
                    [
                        matrixA[1][0] * matrixB[0][0] + matrixA[1][1] * matrixB[1][0],
                        matrixA[1][0] * matrixB[0][1] + matrixA[1][1] * matrixB[1][1]
                    ]
                ];
                
                displayResult(result, '√ó');
            }
            
            function displayResult(result, operation) {
                calcResultDiv.classList.remove('hidden');
                renderMatrix(result, resultContainer);
                
                // Add a description of the operation
                const operationDesc = document.createElement('div');
                operationDesc.className = 'text-center mt-2';
                operationDesc.textContent = `A ${operation} B`;
                resultContainer.appendChild(operationDesc);
            }
            
            // Event listeners
            calcAddBtn.addEventListener('click', addMatrices);
            calcSubtractBtn.addEventListener('click', subtractMatrices);
            calcMultiplyBtn.addEventListener('click', multiplyMatrices);
            calcNewBtn.addEventListener('click', createMatrices);
            
            // Initialize with random matrices
            createMatrices();
        }

        // Determinants Demo
        function initDeterminantsDemo() {
            const canvas = document.getElementById('determinant-canvas');
            const ctx = canvas.getContext('2d');
            const detMatrixContainer = document.getElementById('det-matrix-container');
            const calcDetBtn = document.getElementById('calc-det');
            const detNewBtn = document.getElementById('det-new');
            const detResultDiv = document.getElementById('det-result');
            
            let matrix = [];
            
            function createMatrix() {
                // Create a 2x2 matrix for determinant
                matrix = [];
                for (let i = 0; i < 2; i++) {
                    const row = [];
                    for (let j = 0; j < 2; j++) {
                        row.push(Math.floor(Math.random() * 7) - 3);
                    }
                    matrix.push(row);
                }
                
                renderMatrix(matrix, detMatrixContainer);
                drawDeterminantGeometry();
                detResultDiv.classList.add('hidden');
            }
            
            function calculateDeterminant() {
                const det = matrix[0][0] * matrix[1][1] - matrix[0][1] * matrix[1][0];
                
                detResultDiv.classList.remove('hidden');
                detResultDiv.innerHTML = `
                    <div class="font-medium mb-1">Calculation:</div>
                    <div class="font-mono">det(A) = (${matrix[0][0]} √ó ${matrix[1][1]}) - (${matrix[0][1]} √ó ${matrix[1][0]}) = ${det}</div>
                    <div class="mt-2 ${det !== 0 ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}">
                        ${det !== 0 ? 'Matrix is invertible' : 'Matrix is singular (not invertible)'}
                    </div>
                `;
            }
            
            function drawDeterminantGeometry() {
                const width = canvas.width;
                const height = canvas.height;
                const scale = 30;
                const offsetX = width / 2;
                const offsetY = height / 2;
                
                // Clear canvas
                ctx.clearRect(0, 0, width, height);
                
                // Draw grid
                ctx.strokeStyle = '#ddd';
                ctx.lineWidth = 1;
                
                // Vertical grid lines
                for (let x = -offsetX; x < width; x += scale) {
                    ctx.beginPath();
                    ctx.moveTo(offsetX + x, 0);
                    ctx.lineTo(offsetX + x, height);
                    ctx.stroke();
                }
                
                // Horizontal grid lines
                for (let y = -offsetY; y < height; y += scale) {
                    ctx.beginPath();
                    ctx.moveTo(0, offsetY + y);
                    ctx.lineTo(width, offsetY + y);
                    ctx.stroke();
                }
                
                // Draw axes
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                
                // x-axis
                ctx.beginPath();
                ctx.moveTo(0, offsetY);
                ctx.lineTo(width, offsetY);
                ctx.stroke();
                
                // y-axis
                ctx.beginPath();
                ctx.moveTo(offsetX, 0);
                ctx.lineTo(offsetX, height);
                ctx.stroke();
                
                // Draw parallelogram
                const a = matrix[0][0];
                const b = matrix[0][1];
                const c = matrix[1][0];
                const d = matrix[1][1];
                
                // Draw vectors
                ctx.lineWidth = 2;
                
                // Vector 1
                ctx.strokeStyle = '#5D5CDE';
                ctx.beginPath();
                ctx.moveTo(offsetX, offsetY);
                ctx.lineTo(offsetX + a * scale, offsetY - b * scale);
                ctx.stroke();
                
                // Vector 2
                ctx.strokeStyle = '#E53E3E';
                ctx.beginPath();
                ctx.moveTo(offsetX, offsetY);
                ctx.lineTo(offsetX + c * scale, offsetY - d * scale);
                ctx.stroke();
                
                // Draw parallelogram
                ctx.strokeStyle = '#38A169';
                ctx.beginPath();
                ctx.moveTo(offsetX, offsetY);
                ctx.lineTo(offsetX + a * scale, offsetY - b * scale);
                ctx.lineTo(offsetX + a * scale + c * scale, offsetY - b * scale - d * scale);
                ctx.lineTo(offsetX + c * scale, offsetY - d * scale);
                ctx.closePath();
                ctx.stroke();
                
                // Fill parallelogram with transparency
                ctx.fillStyle = 'rgba(56, 161, 105, 0.2)';
                ctx.fill();
                
                // Calculate and display determinant
                const det = a * d - b * c;
                
                ctx.fillStyle = '#000';
                ctx.font = 'bold 16px Arial';
                ctx.fillText(`Determinant: ${det}`, 20, 30);
                ctx.fillText(`Area: |${det}| = ${Math.abs(det)}`, 20, 60);
                
                // Draw column vector labels
                ctx.fillStyle = '#5D5CDE';
                ctx.font = '14px Arial';
                ctx.fillText(`v‚ÇÅ = [${a}, ${b}]`, offsetX + a * scale / 2, offsetY - b * scale / 2);
                
                ctx.fillStyle = '#E53E3E';
                ctx.fillText(`v‚ÇÇ = [${c}, ${d}]`, offsetX + c * scale / 2, offsetY - d * scale / 2);
            }
            
            // Event listeners
            calcDetBtn.addEventListener('click', calculateDeterminant);
            detNewBtn.addEventListener('click', createMatrix);
            
            // Initialize with a random matrix
            createMatrix();
        }

        // Inverse Matrix Demo
        function initInverseMatrixDemo() {
            const invMatrixContainer = document.getElementById('inv-matrix-container');
            const augmentedInverseMatrix = document.getElementById('augmented-inverse-matrix');
            const calcInverseBtn = document.getElementById('calc-inverse');
            const invNextStepBtn = document.getElementById('inv-next-step');
            const invNewBtn = document.getElementById('inv-new');
            const invExplanation = document.getElementById('inv-explanation');
            
            let matrix = [];
            let augMatrix = [];
            let currentStep = 0;
            let operationHistory = [];
            
            function createMatrix() {
                // Create a random 2x2 matrix with determinant != 0
                do {
                    matrix = [];
                    for (let i = 0; i < 2; i++) {
                        const row = [];
                        for (let j = 0; j < 2; j++) {
                            row.push(Math.floor(Math.random() * 7) - 3);
                        }
                        matrix.push(row);
                    }
                    
                    // Calculate determinant
                    const det = matrix[0][0] * matrix[1][1] - matrix[0][1] * matrix[1][0];
                    
                    // Ensure det != 0
                    if (det !== 0) break;
                } while (true);
                
                // Create augmented matrix [A|I]
                augMatrix = [
                    [...matrix[0], 1, 0],
                    [...matrix[1], 0, 1]
                ];
                
                currentStep = 0;
                operationHistory = [];
                
                renderMatrix(matrix, invMatrixContainer);
                renderMatrix(augMatrix, augmentedInverseMatrix, true, 2);
                
                invExplanation.textContent = "Click 'Next Step' to begin finding the inverse using Gauss-Jordan elimination.";
            }
            
            function calculateInverse() {
                // Calculate inverse directly
                const a = matrix[0][0];
                const b = matrix[0][1];
                const c = matrix[1][0];
                const d = matrix[1][1];
                
                const det = a * d - b * c;
                
                const invA = d / det;
                const invB = -b / det;
                const invC = -c / det;
                const invD = a / det;
                
                const invMatrix = [
                    [invA, invB],
                    [invC, invD]
                ];
                
                // Complete the augmented matrix
                augMatrix = [
                    [1, 0, invA, invB],
                    [0, 1, invC, invD]
                ];
                
                renderMatrix(augMatrix, augmentedInverseMatrix, true, 2);
                
                invExplanation.innerHTML = `
                    <div class="font-medium mb-1">Inverse Calculation:</div>
                    <div class="font-mono">A<sup>-1</sup> = (1/det(A)) √ó adj(A)</div>
                    <div class="font-mono">det(A) = ${a} √ó ${d} - ${b} √ó ${c} = ${det}</div>
                    <div class="font-mono">A<sup>-1</sup> = (1/${det}) √ó [${d} ${-b}; ${-c} ${a}] = [${invA.toFixed(2)} ${invB.toFixed(2)}; ${invC.toFixed(2)} ${invD.toFixed(2)}]</div>
                `;
            }
            
            function nextStep() {
                if (isInReducedRowEchelonForm()) {
                    invExplanation.textContent = "Matrix is in RREF form [I|A^-1]. The right side contains the inverse matrix!";
                    return;
                }
                
                let operation = '';
                
                // Forward elimination to get 1s in the diagonal
                if (augMatrix[0][0] !== 1) {
                    // Scale first row to get 1 in the (0,0) position
                    const factor = 1 / augMatrix[0][0];
                    for (let j = 0; j < 4; j++) {
                        augMatrix[0][j] *= factor;
                        // Clean up any floating point errors
                        augMatrix[0][j] = Math.round(augMatrix[0][j] * 1000) / 1000;
                    }
                    operation = `R1 = ${factor.toFixed(2)} √ó R1`;
                }
                else if (augMatrix[0][1] !== 0) {
                    // Eliminate (1,0) position
                    const factor = augMatrix[1][0];
                    for (let j = 0; j < 4; j++) {
                        augMatrix[1][j] -= factor * augMatrix[0][j];
                        // Clean up any floating point errors
                        augMatrix[1][j] = Math.round(augMatrix[1][j] * 1000) / 1000;
                    }
                    operation = `R2 = R2 - ${factor.toFixed(2)} √ó R1`;
                }
                else if (augMatrix[1][1] !== 1) {
                    // Scale second row to get 1 in the (1,1) position
                    const factor = 1 / augMatrix[1][1];
                    for (let j = 0; j < 4; j++) {
                        augMatrix[1][j] *= factor;
                        // Clean up any floating point errors
                        augMatrix[1][j] = Math.round(augMatrix[1][j] * 1000) / 1000;
                    }
                    operation = `R2 = ${factor.toFixed(2)} √ó R2`;
                }
                else if (augMatrix[0][1] !== 0) {
                    // Eliminate (0,1) position
                    const factor = augMatrix[0][1];
                    for (let j = 0; j < 4; j++) {
                        augMatrix[0][j] -= factor * augMatrix[1][j];
                        // Clean up any floating point errors
                        augMatrix[0][j] = Math.round(augMatrix[0][j] * 1000) / 1000;
                    }
                    operation = `R1 = R1 - ${factor.toFixed(2)} √ó R2`;
                }
                
                currentStep++;
                operationHistory.push(operation);
                renderMatrix(augMatrix, augmentedInverseMatrix, true, 2);
                invExplanation.textContent = `Step ${currentStep}: ${operation}`;
                
                // Check if we're done
                if (isInReducedRowEchelonForm()) {
                    invExplanation.textContent += ". The right half of the matrix is now A^-1!";
                }
            }
            
            function isInReducedRowEchelonForm() {
                return (
                    Math.abs(augMatrix[0][0] - 1) < 0.001 &&
                    Math.abs(augMatrix[1][1] - 1) < 0.001 &&
                    Math.abs(augMatrix[0][1]) < 0.001 &&
                    Math.abs(augMatrix[1][0]) < 0.001
                );
            }
            
            // Event listeners
            calcInverseBtn.addEventListener('click', calculateInverse);
            invNextStepBtn.addEventListener('click', nextStep);
            invNewBtn.addEventListener('click', createMatrix);
            
            // Initialize with a random matrix
            createMatrix();
        }

        // Vectors Demo
        function initVectorsDemo() {
            const vectorSvg = document.getElementById('vector-svg');
            const vectorOpSvg = document.getElementById('vector-operations-svg');
            const vectorResult = document.getElementById('vector-result');
            
            const uXInput = document.getElementById('u-x');
            const uYInput = document.getElementById('u-y');
            const vXInput = document.getElementById('v-x');
            const vYInput = document.getElementById('v-y');
            
            const addBtn = document.getElementById('vector-add');
            const subtractBtn = document.getElementById('vector-subtract');
            const dotBtn = document.getElementById('vector-dot');
            const scaleBtn = document.getElementById('vector-scale');
            
            function drawBaseVectors() {
                // Clear SVG
                vectorSvg.innerHTML = '';
                
                // Draw grid and axes
                const grid = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                
                // Add axes
                const xAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                xAxis.setAttribute('x1', '0');
                xAxis.setAttribute('y1', '150');
                xAxis.setAttribute('x2', '300');
                xAxis.setAttribute('y2', '150');
                xAxis.setAttribute('stroke', 'currentColor');
                xAxis.setAttribute('class', 'axis-line');
                
                const yAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                yAxis.setAttribute('x1', '150');
                yAxis.setAttribute('y1', '0');
                yAxis.setAttribute('x2', '150');
                yAxis.setAttribute('y2', '300');
                yAxis.setAttribute('stroke', 'currentColor');
                yAxis.setAttribute('class', 'axis-line');
                
                grid.appendChild(xAxis);
                grid.appendChild(yAxis);
                
                // Add labels
                const xLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                xLabel.setAttribute('x', '290');
                xLabel.setAttribute('y', '140');
                xLabel.setAttribute('fill', 'currentColor');
                xLabel.textContent = 'x';
                
                const yLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                yLabel.setAttribute('x', '160');
                yLabel.setAttribute('y', '15');
                yLabel.setAttribute('fill', 'currentColor');
                yLabel.textContent = 'y';
                
                grid.appendChild(xLabel);
                grid.appendChild(yLabel);
                
                vectorSvg.appendChild(grid);
                
                // Draw standard basis vectors
                const iVector = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                iVector.setAttribute('x1', '150');
                iVector.setAttribute('y1', '150');
                iVector.setAttribute('x2', '200');
                iVector.setAttribute('y2', '150');
                iVector.setAttribute('stroke', '#5D5CDE');
                iVector.setAttribute('class', 'vector-arrow');
                
                const jVector = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                jVector.setAttribute('x1', '150');
                jVector.setAttribute('y1', '150');
                jVector.setAttribute('x2', '150');
                jVector.setAttribute('y2', '100');
                jVector.setAttribute('stroke', '#E53E3E');
                jVector.setAttribute('class', 'vector-arrow');
                
                vectorSvg.appendChild(iVector);
                vectorSvg.appendChild(jVector);
                
                // Add labels for basis vectors
                const iLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                iLabel.setAttribute('x', '190');
                iLabel.setAttribute('y', '140');
                iLabel.setAttribute('fill', '#5D5CDE');
                iLabel.textContent = 'i';
                
                const jLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                jLabel.setAttribute('x', '140');
                jLabel.setAttribute('y', '110');
                jLabel.setAttribute('fill', '#E53E3E');
                jLabel.textContent = 'j';
                
                vectorSvg.appendChild(iLabel);
                vectorSvg.appendChild(jLabel);
                
                // Example vector
                const exVector = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                exVector.setAttribute('x1', '150');
                exVector.setAttribute('y1', '150');
                exVector.setAttribute('x2', '210');
                exVector.setAttribute('y2', '110');
                exVector.setAttribute('stroke', '#38A169');
                exVector.setAttribute('class', 'vector-arrow');
                
                const exLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                exLabel.setAttribute('x', '215');
                exLabel.setAttribute('y', '105');
                exLabel.setAttribute('fill', '#38A169');
                exLabel.textContent = 'v = [2, 1.5]';
                
                vectorSvg.appendChild(exVector);
                vectorSvg.appendChild(exLabel);
            }
            
            function initVectorOperations() {
                // Draw coordinate system
                updateVectorOperations();
                
                // Add event listeners for inputs
                uXInput.addEventListener('input', updateVectorOperations);
                uYInput.addEventListener('input', updateVectorOperations);
                vXInput.addEventListener('input', updateVectorOperations);
                vYInput.addEventListener('input', updateVectorOperations);
                
                // Add event listeners for operation buttons
                addBtn.addEventListener('click', () => performVectorOperation('add'));
                subtractBtn.addEventListener('click', () => performVectorOperation('subtract'));
                dotBtn.addEventListener('click', () => performVectorOperation('dot'));
                scaleBtn.addEventListener('click', () => performVectorOperation('scale'));
            }
            
            function updateVectorOperations() {
                // Clear SVG
                vectorOpSvg.innerHTML = '';
                
                // Clear result
                vectorResult.textContent = '';
                
                // Get vector components
                const ux = parseFloat(uXInput.value) || 0;
                const uy = parseFloat(uYInput.value) || 0;
                const vx = parseFloat(vXInput.value) || 0;
                const vy = parseFloat(vYInput.value) || 0;
                
                // Draw grid
                drawVectorGrid();
                
                // Draw vectors
                drawVector(ux, uy, '#5D5CDE', 'u', 0.2, 0.8);
                drawVector(vx, vy, '#E53E3E', 'v', 0.8, 0.2);
            }
            
            function drawVectorGrid() {
                // Draw axes
                const xAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                xAxis.setAttribute('x1', '-10');
                xAxis.setAttribute('y1', '0');
                xAxis.setAttribute('x2', '10');
                xAxis.setAttribute('y2', '0');
                xAxis.setAttribute('stroke', 'currentColor');
                xAxis.setAttribute('stroke-width', '0.1');
                
                const yAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                yAxis.setAttribute('x1', '0');
                yAxis.setAttribute('y1', '-10');
                yAxis.setAttribute('x2', '0');
                yAxis.setAttribute('y2', '10');
                yAxis.setAttribute('stroke', 'currentColor');
                yAxis.setAttribute('stroke-width', '0.1');
                
                vectorOpSvg.appendChild(xAxis);
                vectorOpSvg.appendChild(yAxis);
                
                // Draw grid lines
                for (let i = -9; i <= 9; i++) {
                    if (i === 0) continue;
                    
                    const hLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    hLine.setAttribute('x1', '-10');
                    hLine.setAttribute('y1', i.toString());
                    hLine.setAttribute('x2', '10');
                    hLine.setAttribute('y2', i.toString());
                    hLine.setAttribute('stroke', 'currentColor');
                    hLine.setAttribute('stroke-width', '0.05');
                    hLine.setAttribute('stroke-opacity', '0.3');
                    
                    const vLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    vLine.setAttribute('x1', i.toString());
                    vLine.setAttribute('y1', '-10');
                    vLine.setAttribute('x2', i.toString());
                    vLine.setAttribute('y2', '10');
                    vLine.setAttribute('stroke', 'currentColor');
                    vLine.setAttribute('stroke-width', '0.05');
                    vLine.setAttribute('stroke-opacity', '0.3');
                    
                    vectorOpSvg.appendChild(hLine);
                    vectorOpSvg.appendChild(vLine);
                }
                
                // Add axis labels
                const xLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                xLabel.setAttribute('x', '9.5');
                xLabel.setAttribute('y', '0.8');
                xLabel.setAttribute('fill', 'currentColor');
                xLabel.setAttribute('font-size', '0.8');
                xLabel.textContent = 'x';
                
                const yLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                yLabel.setAttribute('x', '0.5');
                yLabel.setAttribute('y', '-9');
                yLabel.setAttribute('fill', 'currentColor');
                yLabel.setAttribute('font-size', '0.8');
                yLabel.textContent = 'y';
                
                vectorOpSvg.appendChild(xLabel);
                vectorOpSvg.appendChild(yLabel);
            }
            
            function drawVector(x, y, color, label, labelPosX = 0.5, labelPosY = 0.5) {
                const vector = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                vector.setAttribute('x1', '0');
                vector.setAttribute('y1', '0');
                vector.setAttribute('x2', x.toString());
                vector.setAttribute('y2', (-y).toString());  // SVG y-axis is inverted
                vector.setAttribute('stroke', color);
                vector.setAttribute('stroke-width', '0.2');
                vector.setAttribute('marker-end', 'url(#arrowhead)');
                
                const vectorLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                vectorLabel.setAttribute('x', (x * labelPosX).toString());
                vectorLabel.setAttribute('y', (-y * labelPosY - 0.3).toString());
                vectorLabel.setAttribute('fill', color);
                vectorLabel.setAttribute('font-size', '0.8');
                vectorLabel.textContent = `${label} = [${x}, ${y}]`;
                
                vectorOpSvg.appendChild(vector);
                vectorOpSvg.appendChild(vectorLabel);
            }
            
            function performVectorOperation(op) {
                // Get vector components
                const ux = parseFloat(uXInput.value) || 0;
                const uy = parseFloat(uYInput.value) || 0;
                const vx = parseFloat(vXInput.value) || 0;
                const vy = parseFloat(vYInput.value) || 0;
                
                let resultX, resultY, resultLabel, resultColor;
                
                switch (op) {
                    case 'add':
                        resultX = ux + vx;
                        resultY = uy + vy;
                        resultLabel = 'u + v';
                        resultColor = '#38A169';
                        
                        // Display result information
                        vectorResult.innerHTML = `
                            <div class="mt-2">
                                <span class="font-medium">Vector Addition:</span>
                                u + v = [${ux}, ${uy}] + [${vx}, ${vy}] = [${resultX}, ${resultY}]
                            </div>
                        `;
                        
                        // Draw the parallelogram
                        const uEndPoint = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                        uEndPoint.setAttribute('cx', ux.toString());
                        uEndPoint.setAttribute('cy', (-uy).toString());
                        uEndPoint.setAttribute('r', '0.2');
                        uEndPoint.setAttribute('fill', '#5D5CDE');
                        
                        const vEndPoint = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                        vEndPoint.setAttribute('cx', vx.toString());
                        vEndPoint.setAttribute('cy', (-vy).toString());
                        vEndPoint.setAttribute('r', '0.2');
                        vEndPoint.setAttribute('fill', '#E53E3E');
                        
                        const vFromU = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                        vFromU.setAttribute('x1', ux.toString());
                        vFromU.setAttribute('y1', (-uy).toString());
                        vFromU.setAttribute('x2', resultX.toString());
                        vFromU.setAttribute('y2', (-resultY).toString());
                        vFromU.setAttribute('stroke', '#E53E3E');
                        vFromU.setAttribute('stroke-width', '0.1');
                        vFromU.setAttribute('stroke-dasharray', '0.3');
                        
                        const uFromV = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                        uFromV.setAttribute('x1', vx.toString());
                        uFromV.setAttribute('y1', (-vy).toString());
                        uFromV.setAttribute('x2', resultX.toString());
                        uFromV.setAttribute('y2', (-resultY).toString());
                        uFromV.setAttribute('stroke', '#5D5CDE');
                        uFromV.setAttribute('stroke-width', '0.1');
                        uFromV.setAttribute('stroke-dasharray', '0.3');
                        
                        vectorOpSvg.appendChild(uEndPoint);
                        vectorOpSvg.appendChild(vEndPoint);
                        vectorOpSvg.appendChild(vFromU);
                        vectorOpSvg.appendChild(uFromV);
                        break;
                        
                    case 'subtract':
                        resultX = ux - vx;
                        resultY = uy - vy;
                        resultLabel = 'u - v';
                        resultColor = '#805AD5';
                        
                        // Display result information
                        vectorResult.innerHTML = `
                            <div class="mt-2">
                                <span class="font-medium">Vector Subtraction:</span>
                                u - v = [${ux}, ${uy}] - [${vx}, ${vy}] = [${resultX}, ${resultY}]
                            </div>
                        `;
                        
                        // Draw the negated v vector
                        const negV = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                        negV.setAttribute('x1', '0');
                        negV.setAttribute('y1', '0');
                        negV.setAttribute('x2', (-vx).toString());
                        negV.setAttribute('y2', vy.toString());
                        negV.setAttribute('stroke', '#E53E3E');
                        negV.setAttribute('stroke-width', '0.1');
                        negV.setAttribute('stroke-dasharray', '0.3');
                        
                        const negVLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                        negVLabel.setAttribute('x', (-vx * 0.5).toString());
                        negVLabel.setAttribute('y', (vy * 0.5 - 0.3).toString());
                        negVLabel.setAttribute('fill', '#E53E3E');
                        negVLabel.setAttribute('font-size', '0.6');
                        negVLabel.textContent = '-v';
                        
                        vectorOpSvg.appendChild(negV);
                        vectorOpSvg.appendChild(negVLabel);
                        break;
                        
                    case 'dot':
                        const dotProduct = ux * vx + uy * vy;
                        const uMag = Math.sqrt(ux * ux + uy * uy);
                        const vMag = Math.sqrt(vx * vx + vy * vy);
                        
                        // Calculate the angle between vectors
                        let angle = 0;
                        if (uMag > 0 && vMag > 0) {
                            angle = Math.acos(dotProduct / (uMag * vMag)) * (180 / Math.PI);
                        }
                        
                        // Display result information
                        vectorResult.innerHTML = `
                            <div class="mt-2">
                                <span class="font-medium">Dot Product:</span>
                                u ¬∑ v = ${ux} √ó ${vx} + ${uy} √ó ${vy} = ${dotProduct}<br>
                                <span class="font-medium">Magnitudes:</span>
                                |u| = ${uMag.toFixed(2)}, |v| = ${vMag.toFixed(2)}<br>
                                <span class="font-medium">Angle between vectors:</span>
                                Œ∏ = ${angle.toFixed(2)}¬∞<br>
                                <span class="font-medium">Alternative calculation:</span>
                                u ¬∑ v = |u|¬∑|v|¬∑cos(Œ∏) = ${uMag.toFixed(2)} √ó ${vMag.toFixed(2)} √ó cos(${angle.toFixed(2)}¬∞) = ${dotProduct.toFixed(2)}
                            </div>
                        `;
                        
                        // Draw angle arc if vectors are non-zero
                        if (uMag > 0 && vMag > 0) {
                            const radius = 1;
                            const startAngle = Math.atan2(-uy, ux);
                            const endAngle = Math.atan2(-vy, vx);
                            
                            // Determine if we should draw the small or large arc
                            let sweepFlag = 0;
                            const angleDiff = (endAngle - startAngle + 2 * Math.PI) % (2 * Math.PI);
                            if (angleDiff > Math.PI) {
                                sweepFlag = 1;
                            }
                            
                            const x1 = radius * Math.cos(startAngle);
                            const y1 = radius * Math.sin(startAngle);
                            const x2 = radius * Math.cos(endAngle);
                            const y2 = radius * Math.sin(endAngle);
                            
                            const arc = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                            arc.setAttribute('d', `M ${x1},${y1} A ${radius},${radius} 0 ${sweepFlag},1 ${x2},${y2}`);
                            arc.setAttribute('stroke', '#805AD5');
                            arc.setAttribute('stroke-width', '0.1');
                            arc.setAttribute('fill', 'none');
                            
                            const angleLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                            const midAngle = (startAngle + endAngle) / 2;
                            const labelRadius = radius * 1.3;
                            angleLabel.setAttribute('x', (labelRadius * Math.cos(midAngle)).toString());
                            angleLabel.setAttribute('y', (labelRadius * Math.sin(midAngle)).toString());
                            angleLabel.setAttribute('fill', '#805AD5');
                            angleLabel.setAttribute('font-size', '0.6');
                            angleLabel.textContent = `${angle.toFixed(0)}¬∞`;
                            
                            vectorOpSvg.appendChild(arc);
                            vectorOpSvg.appendChild(angleLabel);
                        }
                        return;
                        
                    case 'scale':
                        const scale = 2;  // Example scale factor
                        resultX = ux * scale;
                        resultY = uy * scale;
                        resultLabel = `${scale}u`;
                        resultColor = '#38A169';
                        
                        // Display result information
                        vectorResult.innerHTML = `
                            <div class="mt-2">
                                <span class="font-medium">Vector Scaling:</span>
                                ${scale}u = ${scale} √ó [${ux}, ${uy}] = [${resultX}, ${resultY}]
                            </div>
                        `;
                        break;
                }
                
                // Draw the result vector
                drawVector(resultX, resultY, resultColor, resultLabel);
            }
            
            // Initialize demos
            drawBaseVectors();
            initVectorOperations();
        }

        // Linear Transformations Demo
        function initTransformationsDemo() {
            const transformSvg = document.getElementById('transform-svg');
            const transformType = document.getElementById('transform-type');
            const transformAngle = document.getElementById('transform-angle');
            const transformAngleValue = document.getElementById('transform-angle-value');
            const transformMatrix = document.getElementById('transform-matrix');
            const transformParams = document.getElementById('transform-params');
            
            let grid = [];
            let gridTransformed = [];
            let currentMatrix = [
                [Math.cos(Math.PI/4), -Math.sin(Math.PI/4)],
                [Math.sin(Math.PI/4), Math.cos(Math.PI/4)]
            ];
            
            function initializeGrid() {
                // Create a grid of points
                grid = [];
                for (let x = -4; x <= 4; x += 1) {
                    for (let y = -4; y <= 4; y += 1) {
                        grid.push([x, y]);
                    }
                }
                
                // Initial transformation
                updateTransformation();
                
                // Add event listeners
                transformType.addEventListener('change', updateTransformationControls);
                transformAngle.addEventListener('input', updateTransformation);
                
                // Initialize
                updateTransformationControls();
            }
            
            function updateTransformationControls() {
                const type = transformType.value;
                
                // Reset transform params container
                transformParams.innerHTML = '';
                
                switch (type) {
                    case 'rotation':
                        const angleInput = document.createElement('input');
                        angleInput.type = 'range';
                        angleInput.id = 'transform-angle';
                        angleInput.min = '0';
                        angleInput.max = '360';
                        angleInput.value = '45';
                        angleInput.className = 'w-32';
                        
                        const angleValue = document.createElement('span');
                        angleValue.id = 'transform-angle-value';
                        angleValue.textContent = '45¬∞';
                        
                        transformParams.appendChild(angleInput);
                        transformParams.appendChild(angleValue);
                        
                        angleInput.addEventListener('input', () => {
                            angleValue.textContent = `${angleInput.value}¬∞`;
                            updateTransformation();
                        });
                        break;
                        
                    case 'scaling':
                        const scaleXLabel = document.createElement('label');
                        scaleXLabel.textContent = 'x:';
                        scaleXLabel.className = 'mr-1';
                        
                        const scaleXInput = document.createElement('input');
                        scaleXInput.type = 'number';
                        scaleXInput.id = 'scale-x';
                        scaleXInput.min = '0.1';
                        scaleXInput.max = '3';
                        scaleXInput.step = '0.1';
                        scaleXInput.value = '1.5';
                        scaleXInput.className = 'w-16 p-1 border rounded text-black mr-2';
                        
                        const scaleYLabel = document.createElement('label');
                        scaleYLabel.textContent = 'y:';
                        scaleYLabel.className = 'mr-1';
                        
                        const scaleYInput = document.createElement('input');
                        scaleYInput.type = 'number';
                        scaleYInput.id = 'scale-y';
                        scaleYInput.min = '0.1';
                        scaleYInput.max = '3';
                        scaleYInput.step = '0.1';
                        scaleYInput.value = '0.5';
                        scaleYInput.className = 'w-16 p-1 border rounded text-black';
                        
                        transformParams.appendChild(scaleXLabel);
                        transformParams.appendChild(scaleXInput);
                        transformParams.appendChild(scaleYLabel);
                        transformParams.appendChild(scaleYInput);
                        
                        scaleXInput.addEventListener('input', updateTransformation);
                        scaleYInput.addEventListener('input', updateTransformation);
                        break;
                        
                    case 'shear':
                        const shearXLabel = document.createElement('label');
                        shearXLabel.textContent = 'kx:';
                        shearXLabel.className = 'mr-1';
                        
                        const shearXInput = document.createElement('input');
                        shearXInput.type = 'number';
                        shearXInput.id = 'shear-x';
                        shearXInput.min = '-2';
                        shearXInput.max = '2';
                        shearXInput.step = '0.1';
                        shearXInput.value = '0.5';
                        shearXInput.className = 'w-16 p-1 border rounded text-black mr-2';
                        
                        const shearYLabel = document.createElement('label');
                        shearYLabel.textContent = 'ky:';
                        shearYLabel.className = 'mr-1';
                        
                        const shearYInput = document.createElement('input');
                        shearYInput.type = 'number';
                        shearYInput.id = 'shear-y';
                        shearYInput.min = '-2';
                        shearYInput.max = '2';
                        shearYInput.step = '0.1';
                        shearYInput.value = '0';
                        shearYInput.className = 'w-16 p-1 border rounded text-black';
                        
                        transformParams.appendChild(shearXLabel);
                        transformParams.appendChild(shearXInput);
                        transformParams.appendChild(shearYLabel);
                        transformParams.appendChild(shearYInput);
                        
                        shearXInput.addEventListener('input', updateTransformation);
                        shearYInput.addEventListener('input', updateTransformation);
                        break;
                        
                    case 'reflection':
                        const reflectionSelect = document.createElement('select');
                        reflectionSelect.id = 'reflection-axis';
                        reflectionSelect.className = 'p-1 border rounded text-black';
                        
                        const options = [
                            { value: 'x', text: 'About x-axis' },
                            { value: 'y', text: 'About y-axis' },
                            { value: 'origin', text: 'Through origin' },
                            { value: 'xy', text: 'About y=x' }
                        ];
                        
                        options.forEach(opt => {
                            const option = document.createElement('option');
                            option.value = opt.value;
                            option.textContent = opt.text;
                            reflectionSelect.appendChild(option);
                        });
                        
                        transformParams.appendChild(reflectionSelect);
                        
                        reflectionSelect.addEventListener('change', updateTransformation);
                        break;
                }
                
                // Update the transformation
                updateTransformation();
            }
            
            function updateTransformation() {
                const type = transformType.value;
                
                switch (type) {
                    case 'rotation':
                        const angleInput = document.getElementById('transform-angle');
                        const angle = parseInt(angleInput.value) * (Math.PI / 180);
                        
                        currentMatrix = [
                            [Math.cos(angle), -Math.sin(angle)],
                            [Math.sin(angle), Math.cos(angle)]
                        ];
                        break;
                        
                    case 'scaling':
                        const scaleX = parseFloat(document.getElementById('scale-x').value) || 1;
                        const scaleY = parseFloat(document.getElementById('scale-y').value) || 1;
                        
                        currentMatrix = [
                            [scaleX, 0],
                            [0, scaleY]
                        ];
                        break;
                        
                    case 'shear':
                        const kx = parseFloat(document.getElementById('shear-x').value) || 0;
                        const ky = parseFloat(document.getElementById('shear-y').value) || 0;
                        
                        currentMatrix = [
                            [1, kx],
                            [ky, 1]
                        ];
                        break;
                        
                    case 'reflection':
                        const axis = document.getElementById('reflection-axis').value;
                        
                        switch (axis) {
                            case 'x':
                                currentMatrix = [
                                    [1, 0],
                                    [0, -1]
                                ];
                                break;
                                
                            case 'y':
                                currentMatrix = [
                                    [-1, 0],
                                    [0, 1]
                                ];
                                break;
                                
                            case 'origin':
                                currentMatrix = [
                                    [-1, 0],
                                    [0, -1]
                                ];
                                break;
                                
                            case 'xy':
                                currentMatrix = [
                                    [0, 1],
                                    [1, 0]
                                ];
                                break;
                        }
                        break;
                }
                
                // Apply transformation to each point in the grid
                gridTransformed = grid.map(point => {
                    const x = point[0];
                    const y = point[1];
                    
                    return [
                        currentMatrix[0][0] * x + currentMatrix[0][1] * y,
                        currentMatrix[1][0] * x + currentMatrix[1][1] * y
                    ];
                });
                
                // Display the transformation matrix
                displayMatrix();
                
                // Draw the transformation
                drawTransformation();
            }
            
            function displayMatrix() {
                transformMatrix.innerHTML = `
                    <div class="mt-2 font-mono text-center">
                        Transformation Matrix:<br>
                        [${currentMatrix[0][0].toFixed(2)}, ${currentMatrix[0][1].toFixed(2)}]<br>
                        [${currentMatrix[1][0].toFixed(2)}, ${currentMatrix[1][1].toFixed(2)}]
                    </div>
                `;
            }
            
            function drawTransformation() {
                // Clear SVG
                transformSvg.innerHTML = '';
                
                // Draw grid
                const gridGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                gridGroup.setAttribute('stroke', '#ddd');
                gridGroup.setAttribute('stroke-width', '0.05');
                
                // Draw original grid
                for (let x = -4; x <= 4; x++) {
                    const hLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    hLine.setAttribute('x1', '-4');
                    hLine.setAttribute('y1', x.toString());
                    hLine.setAttribute('x2', '4');
                    hLine.setAttribute('y2', x.toString());
                    
                    const vLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    vLine.setAttribute('x1', x.toString());
                    vLine.setAttribute('y1', '-4');
                    vLine.setAttribute('x2', x.toString());
                    vLine.setAttribute('y2', '4');
                    
                    gridGroup.appendChild(hLine);
                    gridGroup.appendChild(vLine);
                }
                
                transformSvg.appendChild(gridGroup);
                
                // Draw axes
                const xAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                xAxis.setAttribute('x1', '-5');
                xAxis.setAttribute('y1', '0');
                xAxis.setAttribute('x2', '5');
                xAxis.setAttribute('y2', '0');
                xAxis.setAttribute('stroke', 'currentColor');
                xAxis.setAttribute('stroke-width', '0.1');
                
                const yAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                yAxis.setAttribute('x1', '0');
                yAxis.setAttribute('y1', '-5');
                yAxis.setAttribute('x2', '0');
                yAxis.setAttribute('y2', '5');
                yAxis.setAttribute('stroke', 'currentColor');
                yAxis.setAttribute('stroke-width', '0.1');
                
                transformSvg.appendChild(xAxis);
                transformSvg.appendChild(yAxis);
                
                // Draw standard basis vectors
                const iVector = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                iVector.setAttribute('x1', '0');
                iVector.setAttribute('y1', '0');
                iVector.setAttribute('x2', '1');
                iVector.setAttribute('y2', '0');
                iVector.setAttribute('stroke', '#5D5CDE');
                iVector.setAttribute('stroke-width', '0.15');
                iVector.setAttribute('marker-end', 'url(#arrowhead)');
                
                const jVector = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                jVector.setAttribute('x1', '0');
                jVector.setAttribute('y1', '0');
                jVector.setAttribute('x2', '0');
                jVector.setAttribute('y2', '1');
                jVector.setAttribute('stroke', '#E53E3E');
                jVector.setAttribute('stroke-width', '0.15');
                jVector.setAttribute('marker-end', 'url(#arrowhead)');
                
                transformSvg.appendChild(iVector);
                transformSvg.appendChild(jVector);
                
                // Draw transformed basis vectors
                const iTransformed = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                iTransformed.setAttribute('x1', '0');
                iTransformed.setAttribute('y1', '0');
                iTransformed.setAttribute('x2', currentMatrix[0][0].toString());
                iTransformed.setAttribute('y2', currentMatrix[1][0].toString());
                iTransformed.setAttribute('stroke', '#805AD5');
                iTransformed.setAttribute('stroke-width', '0.15');
                iTransformed.setAttribute('marker-end', 'url(#arrowhead)');
                
                const jTransformed = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                jTransformed.setAttribute('x1', '0');
                jTransformed.setAttribute('y1', '0');
                jTransformed.setAttribute('x2', currentMatrix[0][1].toString());
                jTransformed.setAttribute('y2', currentMatrix[1][1].toString());
                jTransformed.setAttribute('stroke', '#38A169');
                jTransformed.setAttribute('stroke-width', '0.15');
                jTransformed.setAttribute('marker-end', 'url(#arrowhead)');
                
                transformSvg.appendChild(iTransformed);
                transformSvg.appendChild(jTransformed);
                
                // Draw transformed grid
                const transformedGridGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                transformedGridGroup.setAttribute('stroke', '#5D5CDE');
                transformedGridGroup.setAttribute('stroke-width', '0.05');
                transformedGridGroup.setAttribute('stroke-opacity', '0.5');
                
                // Connect adjacent points in the grid to form lines
                for (let i = 0; i < 9; i++) {
                    for (let j = 0; j < 9; j++) {
                        const idx = i * 9 + j;
                        
                        // Connect to point to the right
                        if (j < 8) {
                            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                            line.setAttribute('x1', gridTransformed[idx][0].toString());
                            line.setAttribute('y1', gridTransformed[idx][1].toString());
                            line.setAttribute('x2', gridTransformed[idx + 1][0].toString());
                            line.setAttribute('y2', gridTransformed[idx + 1][1].toString());
                            transformedGridGroup.appendChild(line);
                        }
                        
                        // Connect to point below
                        if (i < 8) {
                            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                            line.setAttribute('x1', gridTransformed[idx][0].toString());
                            line.setAttribute('y1', gridTransformed[idx][1].toString());
                            line.setAttribute('x2', gridTransformed[idx + 9][0].toString());
                            line.setAttribute('y2', gridTransformed[idx + 9][1].toString());
                            transformedGridGroup.appendChild(line);
                        }
                    }
                }
                
                transformSvg.appendChild(transformedGridGroup);
                
                // Add labels for basis vectors
                const iLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                iLabel.setAttribute('x', '1.1');
                iLabel.setAttribute('y', '0.2');
                iLabel.setAttribute('fill', '#5D5CDE');
                iLabel.setAttribute('font-size', '0.5');
                iLabel.textContent = 'i';
                
                const jLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                jLabel.setAttribute('x', '0.1');
                jLabel.setAttribute('y', '1.1');
                jLabel.setAttribute('fill', '#E53E3E');
                jLabel.setAttribute('font-size', '0.5');
                jLabel.textContent = 'j';
                
                const iTransformedLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                iTransformedLabel.setAttribute('x', (currentMatrix[0][0] + 0.1).toString());
                iTransformedLabel.setAttribute('y', (currentMatrix[1][0] + 0.2).toString());
                iTransformedLabel.setAttribute('fill', '#805AD5');
                iTransformedLabel.setAttribute('font-size', '0.5');
                iTransformedLabel.textContent = "T(i)";
                
                const jTransformedLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                jTransformedLabel.setAttribute('x', (currentMatrix[0][1] + 0.1).toString());
                jTransformedLabel.setAttribute('y', (currentMatrix[1][1] + 0.2).toString());
                jTransformedLabel.setAttribute('fill', '#38A169');
                jTransformedLabel.setAttribute('font-size', '0.5');
                jTransformedLabel.textContent = "T(j)";
                
                transformSvg.appendChild(iLabel);
                transformSvg.appendChild(jLabel);
                transformSvg.appendChild(iTransformedLabel);
                transformSvg.appendChild(jTransformedLabel);
                
                // Add a unit square to show transformation
                const unitSquare = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                unitSquare.setAttribute('points', '0,0 1,0 1,1 0,1');
                unitSquare.setAttribute('fill', 'rgba(93, 92, 222, 0.2)');
                unitSquare.setAttribute('stroke', 'rgba(93, 92, 222, 0.5)');
                unitSquare.setAttribute('stroke-width', '0.05');
                
                // Add the transformed unit square
                const transformedSquare = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                const p1 = [0, 0];
                const p2 = [currentMatrix[0][0], currentMatrix[1][0]];
                const p3 = [currentMatrix[0][0] + currentMatrix[0][1], currentMatrix[1][0] + currentMatrix[1][1]];
                const p4 = [currentMatrix[0][1], currentMatrix[1][1]];
                
                transformedSquare.setAttribute('points', `${p1[0]},${p1[1]} ${p2[0]},${p2[1]} ${p3[0]},${p3[1]} ${p4[0]},${p4[1]}`);
                transformedSquare.setAttribute('fill', 'rgba(229, 62, 62, 0.2)');
                transformedSquare.setAttribute('stroke', 'rgba(229, 62, 62, 0.5)');
                transformedSquare.setAttribute('stroke-width', '0.05');
                
                transformSvg.appendChild(unitSquare);
                transformSvg.appendChild(transformedSquare);
            }
            
            // Initialize the transformation demo
            initializeGrid();
        }

        // Eigenvalues and Eigenvectors Demo
        function initEigenDemo() {
            const eigenCanvas = document.getElementById('eigen-canvas');
            const ctx = eigenCanvas.getContext('2d');
            const eigenSteps = document.getElementById('eigen-steps');
            
            const step1Btn = document.getElementById('eigen-step1');
            const step2Btn = document.getElementById('eigen-step2');
            const step3Btn = document.getElementById('eigen-step3');
            const step4Btn = document.getElementById('eigen-step4');
            const eigenAnimateBtn = document.getElementById('eigen-animate');
            const eigenNewBtn = document.getElementById('eigen-new');
            
            let matrix = [
                [3, 1],
                [1, 3]
            ];
            
            let eigenvalues = [];
            let eigenvectors = [];
            let animationId = null;
            let currentAngle = 0;
            
            // Visualize the matrix and its eigenvectors
            function drawEigenCanvas() {
                const width = eigenCanvas.width;
                const height = eigenCanvas.height;
                const scale = 40;
                const offsetX = width / 2;
                const offsetY = height / 2;
                
                // Clear canvas
                ctx.clearRect(0, 0, width, height);
                
                // Draw grid
                ctx.strokeStyle = '#ddd';
                ctx.lineWidth = 1;
                
                // Vertical grid lines
                for (let x = -10; x <= 10; x += 1) {
                    ctx.beginPath();
                    ctx.moveTo(offsetX + x * scale, 0);
                    ctx.lineTo(offsetX + x * scale, height);
                    ctx.stroke();
                }
                
                // Horizontal grid lines
                for (let y = -5; y <= 5; y += 1) {
                    ctx.beginPath();
                    ctx.moveTo(0, offsetY + y * scale);
                    ctx.lineTo(width, offsetY + y * scale);
                    ctx.stroke();
                }
                
                // Draw axes
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                
                // x-axis
                ctx.beginPath();
                ctx.moveTo(0, offsetY);
                ctx.lineTo(width, offsetY);
                ctx.stroke();
                
                // y-axis
                ctx.beginPath();
                ctx.moveTo(offsetX, 0);
                ctx.lineTo(offsetX, height);
                ctx.stroke();
                
                // Draw unit vectors
                const vectors = [];
                
                // Add some vectors around the unit circle
                for (let angle = 0; angle < 2 * Math.PI; angle += Math.PI / 8) {
                    const x = Math.cos(angle);
                    const y = Math.sin(angle);
                    vectors.push([x, y]);
                }
                
                // Draw the original vectors
                for (const v of vectors) {
                    drawVector(ctx, offsetX, offsetY, scale, v[0], v[1], '#5D5CDE');
                }
                
                // Draw the transformed vectors
                for (const v of vectors) {
                    // Apply the transformation
                    const transformedX = matrix[0][0] * v[0] + matrix[0][1] * v[1];
                    const transformedY = matrix[1][0] * v[0] + matrix[1][1] * v[1];
                    
                    drawVector(ctx, offsetX, offsetY, scale, transformedX, transformedY, '#E53E3E');
                }
                
                // Draw eigenvectors if calculated
                if (eigenvectors.length > 0) {
                    for (let i = 0; i < eigenvectors.length; i++) {
                        const ev = eigenvectors[i];
                        const lambda = eigenvalues[i];
                        
                        // Normalize eigenvector for better visualization
                        const magnitude = Math.sqrt(ev[0] * ev[0] + ev[1] * ev[1]);
                        const normalizedEV = [ev[0] / magnitude, ev[1] / magnitude];
                        
                        // Scale eigenvector to make it more visible
                        const scaleEV = 2;
                        
                        // Draw the eigenvector
                        drawVector(ctx, offsetX, offsetY, scale, 
                                  normalizedEV[0] * scaleEV, normalizedEV[1] * scaleEV, 
                                  '#38A169', 3);
                        
                        // Label the eigenvector
                        ctx.fillStyle = '#38A169';
                        ctx.font = '14px Arial';
                        const labelX = offsetX + normalizedEV[0] * scaleEV * scale * 1.1;
                        const labelY = offsetY - normalizedEV[1] * scaleEV * scale * 1.1;
                        ctx.fillText(`Œª = ${lambda.toFixed(1)}, v = [${ev[0].toFixed(2)}, ${ev[1].toFixed(2)}]`, labelX, labelY);
                    }
                }
            }
            
            function drawVector(ctx, offsetX, offsetY, scale, x, y, color, width = 1) {
                ctx.strokeStyle = color;
                ctx.lineWidth = width;
                ctx.beginPath();
                ctx.moveTo(offsetX, offsetY);
                ctx.lineTo(offsetX + x * scale, offsetY - y * scale);
                ctx.stroke();
                
                // Draw arrowhead
                const headlen = 10;
                const angle = Math.atan2(-y, x);
                
                ctx.beginPath();
                ctx.moveTo(offsetX + x * scale, offsetY - y * scale);
                ctx.lineTo(offsetX + x * scale - headlen * Math.cos(angle - Math.PI / 6), 
                          offsetY - y * scale + headlen * Math.sin(angle - Math.PI / 6));
                ctx.lineTo(offsetX + x * scale - headlen * Math.cos(angle + Math.PI / 6), 
                          offsetY - y * scale + headlen * Math.sin(angle + Math.PI / 6));
                ctx.closePath();
                ctx.fillStyle = color;
                ctx.fill();
            }
            
            function calculateEigenvalues() {
                // For a 2x2 matrix, we can use the characteristic polynomial
                // Œª¬≤ - tr(A)Œª + det(A) = 0
                const a = matrix[0][0];
                const b = matrix[0][1];
                const c = matrix[1][0];
                const d = matrix[1][1];
                
                const trace = a + d;
                const determinant = a * d - b * c;
                
                // Using the quadratic formula
                const discriminant = trace * trace - 4 * determinant;
                
                if (discriminant < 0) {
                    // Complex eigenvalues
                    const realPart = trace / 2;
                    const imagPart = Math.sqrt(-discriminant) / 2;
                    return [
                        { real: realPart, imag: imagPart },
                        { real: realPart, imag: -imagPart }
                    ];
                } else {
                    // Real eigenvalues
                    const lambda1 = (trace + Math.sqrt(discriminant)) / 2;
                    const lambda2 = (trace - Math.sqrt(discriminant)) / 2;
                    return [lambda1, lambda2];
                }
            }
            
            function calculateEigenvectors() {
                // For each eigenvalue, solve (A - ŒªI)v = 0
                eigenvalues = calculateEigenvalues();
                
                // Only handle real eigenvalues
                if (typeof eigenvalues[0] === 'object') {
                    eigenSteps.innerHTML += "<p>This matrix has complex eigenvalues, which won't be visualized in this demo.</p>";
                    return;
                }
                
                eigenvectors = [];
                
                for (const lambda of eigenvalues) {
                    // Create the matrix A - ŒªI
                    const subtractedMatrix = [
                        [matrix[0][0] - lambda, matrix[0][1]],
                        [matrix[1][0], matrix[1][1] - lambda]
                    ];
                    
                    // Find a non-zero vector in the null space
                    let eigenvector;
                    
                    if (Math.abs(subtractedMatrix[0][0]) < 0.001 && Math.abs(subtractedMatrix[0][1]) < 0.001) {
                        // First row is all zeros, so [0, 1] is in null space
                        eigenvector = [0, 1];
                    } else if (Math.abs(subtractedMatrix[1][0]) < 0.001 && Math.abs(subtractedMatrix[1][1]) < 0.001) {
                        // Second row is all zeros, so [1, 0] is in null space
                        eigenvector = [1, 0];
                    } else if (Math.abs(subtractedMatrix[0][0]) < 0.001) {
                        // First element is zero, so [1, 0] is in null space
                        eigenvector = [1, 0];
                    } else {
                        // General case: solve for x‚ÇÇ in terms of x‚ÇÅ
                        // If a‚ÇÅ‚ÇÅx‚ÇÅ + a‚ÇÅ‚ÇÇx‚ÇÇ = 0, then x‚ÇÇ = -a‚ÇÅ‚ÇÅx‚ÇÅ/a‚ÇÅ‚ÇÇ
                        const x1 = 1;
                        const x2 = -subtractedMatrix[0][0] * x1 / subtractedMatrix[0][1];
                        eigenvector = [x1, x2];
                    }
                    
                    eigenvectors.push(eigenvector);
                }
                
                return eigenvectors;
            }
            
            function animateTransformation() {
                if (animationId) {
                    cancelAnimationFrame(animationId);
                    animationId = null;
                    return;
                }
                
                currentAngle = 0;
                
                function animate() {
                    const width = eigenCanvas.width;
                    const height = eigenCanvas.height;
                    const scale = 40;
                    const offsetX = width / 2;
                    const offsetY = height / 2;
                    
                    // Clear canvas
                    ctx.clearRect(0, 0, width, height);
                    
                    // Draw grid
                    ctx.strokeStyle = '#ddd';
                    ctx.lineWidth = 1;
                    
                    // Vertical grid lines
                    for (let x = -10; x <= 10; x += 1) {
                        ctx.beginPath();
                        ctx.moveTo(offsetX + x * scale, 0);
                        ctx.lineTo(offsetX + x * scale, height);
                        ctx.stroke();
                    }
                    
                    // Horizontal grid lines
                    for (let y = -5; y <= 5; y += 1) {
                        ctx.beginPath();
                        ctx.moveTo(0, offsetY + y * scale);
                        ctx.lineTo(width, offsetY + y * scale);
                        ctx.stroke();
                    }
                    
                    // Draw axes
                    ctx.strokeStyle = '#000';
                    ctx.lineWidth = 2;
                    
                    // x-axis
                    ctx.beginPath();
                    ctx.moveTo(0, offsetY);
                    ctx.lineTo(width, offsetY);
                    ctx.stroke();
                    
                    // y-axis
                    ctx.beginPath();
                    ctx.moveTo(offsetX, 0);
                    ctx.lineTo(offsetX, height);
                    ctx.stroke();
                    
                    // Draw special vectors
                    const vectors = [];
                    
                    // Add vectors around the unit circle
                    for (let angle = 0; angle < 2 * Math.PI; angle += Math.PI / 8) {
                        const x = Math.cos(angle);
                        const y = Math.sin(angle);
                        vectors.push([x, y]);
                    }
                    
                    // Add eigenvectors if calculated
                    if (eigenvectors.length > 0) {
                        for (let i = 0; i < eigenvectors.length; i++) {
                            const ev = eigenvectors[i];
                            const lambda = eigenvalues[i];
                            
                            // Normalize eigenvector for better visualization
                            const magnitude = Math.sqrt(ev[0] * ev[0] + ev[1] * ev[1]);
                            const normalizedEV = [ev[0] / magnitude, ev[1] / magnitude];
                            
                            // Scale eigenvector to make it more visible
                            const scaleEV = 2;
                            vectors.push([normalizedEV[0] * scaleEV, normalizedEV[1] * scaleEV]);
                        }
                    }
                    
                    // Draw the vectors and their transformations with animation
                    const t = Math.sin(currentAngle) * 0.5 + 0.5; // Animation progress (0 to 1)
                    
                    for (const v of vectors) {
                        // Apply the transformation
                        const transformedX = matrix[0][0] * v[0] + matrix[0][1] * v[1];
                        const transformedY = matrix[1][0] * v[0] + matrix[1][1] * v[1];
                        
                        // Interpolate between original and transformed vector
                        const interpolatedX = v[0] * (1 - t) + transformedX * t;
                        const interpolatedY = v[1] * (1 - t) + transformedY * t;
                        
                        // Draw the interpolated vector
                        const isEigenvector = eigenvectors.some(ev => {
                            const mag = Math.sqrt(ev[0] * ev[0] + ev[1] * ev[1]);
                            const normalizedEV = [ev[0] / mag, ev[1] / mag];
                            const dotProduct = normalizedEV[0] * v[0] / Math.sqrt(v[0]*v[0] + v[1]*v[1]) + 
                                              normalizedEV[1] * v[1] / Math.sqrt(v[0]*v[0] + v[1]*v[1]);
                            return Math.abs(Math.abs(dotProduct) - 1) < 0.1;
                        });
                        
                        if (isEigenvector) {
                            drawVector(ctx, offsetX, offsetY, scale, interpolatedX, interpolatedY, '#38A169', 3);
                        } else {
                            drawVector(ctx, offsetX, offsetY, scale, interpolatedX, interpolatedY, '#5D5CDE');
                        }
                    }
                    
                    // Provide a visual cue for eigenvectors
                    if (eigenvectors.length > 0) {
                        for (let i = 0; i < eigenvectors.length; i++) {
                            const ev = eigenvectors[i];
                            const lambda = eigenvalues[i];
                            
                            // Normalize eigenvector for better visualization
                            const magnitude = Math.sqrt(ev[0] * ev[0] + ev[1] * ev[1]);
                            const normalizedEV = [ev[0] / magnitude, ev[1] / magnitude];
                            
                            // Scale eigenvector to make it more visible
                            const scaleEV = 2;
                            
                            // Label the eigenvector
                            ctx.fillStyle = '#38A169';
                            ctx.font = '14px Arial';
                            const labelX = offsetX + normalizedEV[0] * scaleEV * scale * 1.1;
                            const labelY = offsetY - normalizedEV[1] * scaleEV * scale * 1.1;
                            ctx.fillText(`Œª = ${lambda.toFixed(1)}, v = [${ev[0].toFixed(2)}, ${ev[1].toFixed(2)}]`, labelX, labelY);
                            
                            // Highlight that eigenvectors only change in length
                            const transformedMagnitude = Math.abs(lambda) * scaleEV;
                            const originalVector = [normalizedEV[0] * scaleEV, normalizedEV[1] * scaleEV];
                            const transformedVector = [normalizedEV[0] * transformedMagnitude, normalizedEV[1] * transformedMagnitude];
                            
                            // Draw a line connecting the original and transformed vector endpoints
                            ctx.setLineDash([5, 5]);
                            ctx.beginPath();
                            ctx.moveTo(offsetX + originalVector[0] * scale, offsetY - originalVector[1] * scale);
                            ctx.lineTo(offsetX + transformedVector[0] * scale, offsetY - transformedVector[1] * scale);
                            ctx.strokeStyle = '#38A169';
                            ctx.stroke();
                            ctx.setLineDash([]);
                        }
                    }
                    
                    // Add animation guidance text
                    ctx.fillStyle = '#000';
                    ctx.font = 'bold 14px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('Vectors are being transformed by the matrix', width / 2, 20);
                    ctx.fillText('Notice eigenvectors maintain their direction!', width / 2, 40);
                    
                    // Update animation
                    currentAngle += 0.02;
                    
                    animationId = requestAnimationFrame(animate);
                }
                
                animationId = requestAnimationFrame(animate);
            }
            
            function setUpCharacteristicEquation() {
                eigenSteps.innerHTML = `
                    <h4 class="font-semibold mb-1">Step 1: Set up the characteristic equation</h4>
                    <p class="mb-2">The characteristic equation is det(A - ŒªI) = 0</p>
                    <div class="flex flex-col items-center mb-2">
                        <div class="font-mono">
                            A - ŒªI = 
                            <table class="matrix-table mx-2">
                                <tr>
                                    <td class="matrix-cell">${matrix[0][0]} - Œª</td>
                                    <td class="matrix-cell">${matrix[0][1]}</td>
                                </tr>
                                <tr>
                                    <td class="matrix-cell">${matrix[1][0]}</td>
                                    <td class="matrix-cell">${matrix[1][1]} - Œª</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                `;
            }
            
            function computeCharacteristicPolynomial() {
                const a = matrix[0][0];
                const b = matrix[0][1];
                const c = matrix[1][0];
                const d = matrix[1][1];
                
                eigenSteps.innerHTML = `
                    <h4 class="font-semibold mb-1">Step 2: Compute the determinant</h4>
                    <p class="mb-2">We need to compute det(A - ŒªI):</p>
                    <div class="flex flex-col items-center mb-2">
                        <div class="font-mono">
                            det(A - ŒªI) = det
                            <table class="matrix-table mx-2">
                                <tr>
                                    <td class="matrix-cell">${a} - Œª</td>
                                    <td class="matrix-cell">${b}</td>
                                </tr>
                                <tr>
                                    <td class="matrix-cell">${c}</td>
                                    <td class="matrix-cell">${d} - Œª</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <p class="mb-2">Computing the determinant:</p>
                    <div class="font-mono mb-2">
                        det(A - ŒªI) = (${a} - Œª)(${d} - Œª) - ${b} √ó ${c}
                    </div>
                    <div class="font-mono mb-2">
                        = (${a} - Œª)(${d} - Œª) - ${b * c}
                    </div>
                    <div class="font-mono mb-2">
                        = Œª¬≤ - ${a + d}Œª + ${a * d} - ${b * c}
                    </div>
                    <div class="font-mono mb-2">
                        = Œª¬≤ - ${a + d}Œª + ${a * d - b * c}
                    </div>
                    <p class="mb-2">Setting this equal to zero gives us our characteristic polynomial:</p>
                    <div class="font-mono font-bold">
                        Œª¬≤ - ${a + d}Œª + ${a * d - b * c} = 0
                    </div>
                `;
            }
            
            function solveForEigenvalues() {
                const a = matrix[0][0];
                const b = matrix[0][1];
                const c = matrix[1][0];
                const d = matrix[1][1];
                
                const trace = a + d;
                const determinant = a * d - b * c;
                
                // Using the quadratic formula
                const discriminant = trace * trace - 4 * determinant;
                
                let eigenvalueText = '';
                
                if (discriminant < 0) {
                    // Complex eigenvalues
                    const realPart = trace / 2;
                    const imagPart = Math.sqrt(-discriminant) / 2;
                    eigenvalueText = `
                        <div class="font-mono mb-2">
                            Œª‚ÇÅ = ${realPart.toFixed(2)} + ${imagPart.toFixed(2)}i
                        </div>
                        <div class="font-mono mb-2">
                            Œª‚ÇÇ = ${realPart.toFixed(2)} - ${imagPart.toFixed(2)}i
                        </div>
                    `;
                    eigenvalues = [
                        { real: realPart, imag: imagPart },
                        { real: realPart, imag: -imagPart }
                    ];
                } else {
                    // Real eigenvalues
                    const lambda1 = (trace + Math.sqrt(discriminant)) / 2;
                    const lambda2 = (trace - Math.sqrt(discriminant)) / 2;
                    eigenvalueText = `
                        <div class="font-mono mb-2">
                            Œª‚ÇÅ = ${lambda1.toFixed(2)}
                        </div>
                        <div class="font-mono mb-2">
                            Œª‚ÇÇ = ${lambda2.toFixed(2)}
                        </div>
                    `;
                    eigenvalues = [lambda1, lambda2];
                }
                
                eigenSteps.innerHTML = `
                    <h4 class="font-semibold mb-1">Step 3: Find the eigenvalues</h4>
                    <p class="mb-2">We can use the quadratic formula to solve our characteristic equation:</p>
                    <div class="font-mono mb-2">
                        Œª¬≤ - ${trace}Œª + ${determinant} = 0
                    </div>
                    <p class="mb-2">Using the quadratic formula: Œª = [${trace} ¬± ‚àö(${trace}¬≤ - 4 √ó ${determinant})] / 2</p>
                    <p class="mb-2">Discriminant = ${trace}¬≤ - 4 √ó ${determinant} = ${discriminant.toFixed(2)}</p>
                    <p class="mb-2">Therefore, our eigenvalues are:</p>
                    ${eigenvalueText}
                `;
            }
            
            function findEigenvectors() {
                if (typeof eigenvalues[0] === 'object') {
                    // Complex eigenvalues
                    eigenSteps.innerHTML = `
                        <h4 class="font-semibold mb-1">Step 4: Find the eigenvectors</h4>
                        <p class="mb-2">This matrix has complex eigenvalues. The eigenvectors will also be complex, but we'll focus on real eigenvectors for this visualization.</p>
                    `;
                    return;
                }
                
                // Calculate eigenvectors
                calculateEigenvectors();
                
                let eigenvectorHTML = '';
                for (let i = 0; i < eigenvalues.length; i++) {
                    const lambda = eigenvalues[i];
                    const subtractedMatrix = [
                        [matrix[0][0] - lambda, matrix[0][1]],
                        [matrix[1][0], matrix[1][1] - lambda]
                    ];
                    
                    eigenvectorHTML += `
                        <div class="mb-3 p-2 bg-gray-50 dark:bg-gray-800 rounded">
                            <h5 class="font-medium">For Œª = ${lambda.toFixed(2)}:</h5>
                            <div class="font-mono mt-1">
                                (A - ŒªI)v = 
                                <table class="matrix-table mx-2">
                                    <tr>
                                        <td class="matrix-cell">${subtractedMatrix[0][0].toFixed(2)}</td>
                                        <td class="matrix-cell">${subtractedMatrix[0][1].toFixed(2)}</td>
                                    </tr>
                                    <tr>
                                        <td class="matrix-cell">${subtractedMatrix[1][0].toFixed(2)}</td>
                                        <td class="matrix-cell">${subtractedMatrix[1][1].toFixed(2)}</td>
                                    </tr>
                                </table>
                                v = 0
                            </div>
                            <p class="mt-1">This gives us the homogeneous system:</p>
                            <div class="font-mono mt-1">
                                ${subtractedMatrix[0][0].toFixed(2)}x + ${subtractedMatrix[0][1].toFixed(2)}y = 0
                            </div>
                            <div class="font-mono mb-1">
                                ${subtractedMatrix[1][0].toFixed(2)}x + ${subtractedMatrix[1][1].toFixed(2)}y = 0
                            </div>
                            <p class="mt-1">Solving this system, we get the eigenvector:</p>
                            <div class="font-mono mt-1 font-bold">
                                v = [${eigenvectors[i][0].toFixed(2)}, ${eigenvectors[i][1].toFixed(2)}]
                            </div>
                        </div>
                    `;
                }
                
                eigenSteps.innerHTML = `
                    <h4 class="font-semibold mb-1">Step 4: Find the eigenvectors</h4>
                    <p class="mb-2">For each eigenvalue Œª, we need to find non-zero vectors v such that (A - ŒªI)v = 0.</p>
                    ${eigenvectorHTML}
                    <p class="mt-2">Each eigenvector corresponds to a direction that is only scaled (not rotated) by the transformation.</p>
                `;
                
                // Draw the eigenvectors
                drawEigenCanvas();
            }
            
            function createNewMatrix() {
                // Create a random 2x2 matrix with real eigenvalues
                let newMatrix;
                let realEigenvalues;
                
                do {
                    newMatrix = [
                        [Math.floor(Math.random() * 7) - 3, Math.floor(Math.random() * 7) - 3],
                        [Math.floor(Math.random() * 7) - 3, Math.floor(Math.random() * 7) - 3]
                    ];
                    
                    // Ensure matrix has real eigenvalues
                    const a = newMatrix[0][0];
                    const b = newMatrix[0][1];
                    const c = newMatrix[1][0];
                    const d = newMatrix[1][1];
                    
                    const trace = a + d;
                    const determinant = a * d - b * c;
                    
                    const discriminant = trace * trace - 4 * determinant;
                    realEigenvalues = discriminant >= 0;
                    
                } while (!realEigenvalues);
                
                // Update the matrix
                matrix = newMatrix;
                
                // Reset the eigenvalues and eigenvectors
                eigenvalues = [];
                eigenvectors = [];
                
                // Update the display
                const eigenMatrix = document.getElementById('eigen-matrix');
                eigenMatrix.innerHTML = `
                    <table class="matrix-table">
                        <tr>
                            <td class="matrix-cell">${matrix[0][0]}</td>
                            <td class="matrix-cell">${matrix[0][1]}</td>
                        </tr>
                        <tr>
                            <td class="matrix-cell">${matrix[1][0]}</td>
                            <td class="matrix-cell">${matrix[1][1]}</td>
                        </tr>
                    </table>
                `;
                
                // Reset the steps display
                eigenSteps.innerHTML = '<p>Click "Step 1" to begin calculating eigenvalues and eigenvectors.</p>';
                
                // Draw the canvas
                drawEigenCanvas();
                
                // Stop any ongoing animation
                if (animationId) {
                    cancelAnimationFrame(animationId);
                    animationId = null;
                }
            }
            
            // Handling user matrix input
            const updateEigenMatrixBtn = document.getElementById('update-eigen-matrix');
            updateEigenMatrixBtn.addEventListener('click', () => {
                // Get values from the input matrix
                const matrixInputs = document.querySelectorAll('#eigen-matrix-input input');
                matrix = [
                    [parseFloat(matrixInputs[0].value), parseFloat(matrixInputs[1].value)],
                    [parseFloat(matrixInputs[2].value), parseFloat(matrixInputs[3].value)]
                ];
                
                // Reset eigenvalues and eigenvectors
                eigenvalues = [];
                eigenvectors = [];
                
                // Reset the steps display
                eigenSteps.innerHTML = '<p>Matrix updated. Click "Step 1" to begin calculating eigenvalues and eigenvectors.</p>';
                
                // Redraw the canvas with the new matrix
                drawEigenCanvas();
                
                // Stop any ongoing animation
                if (animationId) {
                    cancelAnimationFrame(animationId);
                    animationId = null;
                }
            });
            
            // Event listeners
            step1Btn.addEventListener('click', setUpCharacteristicEquation);
            step2Btn.addEventListener('click', computeCharacteristicPolynomial);
            step3Btn.addEventListener('click', solveForEigenvalues);
            step4Btn.addEventListener('click', findEigenvectors);
            eigenAnimateBtn.addEventListener('click', animateTransformation);
            eigenNewBtn.addEventListener('click', createNewMatrix);
            
            // Initialize the demo
            drawEigenCanvas();
        }

        // Stock Portfolio Demo
        function initStockPortfolioDemo() {
            const initialPortfolio = document.getElementById('initial-portfolio');
            const marketImpact = document.getElementById('market-impact');
            const calculationStep1 = document.getElementById('calculation-step1');
            const calculationStep2 = document.getElementById('calculation-step2');
            const calculationStep3 = document.getElementById('calculation-step3');
            const portfolioChart = document.getElementById('portfolio-chart');
            const showCalculationBtn = document.getElementById('show-calculation');
            const changeScenarioBtn = document.getElementById('change-scenario');
            
            // Default initial portfolio values (in dollars)
            let portfolio = {
                apple: 5000,
                google: 8000,
                microsoft: 6000
            };
            
            // Default market impact (as multipliers)
            let impact = {
                apple: 1.05,     // 5% increase
                google: 0.97,    // 3% decrease
                microsoft: 1.02  // 2% increase
            };
            
            // Initialize chart
            let portfolioBarChart;
            
            function displayPortfolio() {
                // Display initial portfolio as a vector
                initialPortfolio.innerHTML = `
                    <div class="flex justify-center">
                        <table class="matrix-table">
                            <tr>
                                <td class="matrix-cell">Apple</td>
                                <td class="matrix-cell">$${portfolio.apple}</td>
                            </tr>
                            <tr>
                                <td class="matrix-cell">Google</td>
                                <td class="matrix-cell">$${portfolio.google}</td>
                            </tr>
                            <tr>
                                <td class="matrix-cell">Microsoft</td>
                                <td class="matrix-cell">$${portfolio.microsoft}</td>
                            </tr>
                        </table>
                    </div>
                `;
                
                // Display market impact as a matrix
                marketImpact.innerHTML = `
                    <div class="flex justify-center">
                        <table class="matrix-table">
                            <tr>
                                <td class="matrix-cell">Apple</td>
                                <td class="matrix-cell">${impact.apple > 1 ? '+' : ''}${((impact.apple - 1) * 100).toFixed(1)}%</td>
                            </tr>
                            <tr>
                                <td class="matrix-cell">Google</td>
                                <td class="matrix-cell">${impact.google > 1 ? '+' : ''}${((impact.google - 1) * 100).toFixed(1)}%</td>
                            </tr>
                            <tr>
                                <td class="matrix-cell">Microsoft</td>
                                <td class="matrix-cell">${impact.microsoft > 1 ? '+' : ''}${((impact.microsoft - 1) * 100).toFixed(1)}%</td>
                            </tr>
                        </table>
                    </div>
                `;
                
                // Draw the chart
                updatePortfolioChart();
            }
            
            function calculateUpdatedPortfolio() {
                // Calculate the updated portfolio
                const updatedPortfolio = {
                    apple: portfolio.apple * impact.apple,
                    google: portfolio.google * impact.google,
                    microsoft: portfolio.microsoft * impact.microsoft
                };
                
                return updatedPortfolio;
            }
            
            function showCalculation() {
                // Display the calculation steps
                const updatedPortfolio = calculateUpdatedPortfolio();
                
                calculationStep1.innerHTML = `
                    <div class="flex items-center justify-center gap-2">
                        <div>
                            <table class="matrix-table">
                                <tr>
                                    <td class="matrix-cell">${impact.apple.toFixed(2)}</td>
                                    <td class="matrix-cell">0</td>
                                    <td class="matrix-cell">0</td>
                                </tr>
                                <tr>
                                    <td class="matrix-cell">0</td>
                                    <td class="matrix-cell">${impact.google.toFixed(2)}</td>
                                    <td class="matrix-cell">0</td>
                                </tr>
                                <tr>
                                    <td class="matrix-cell">0</td>
                                    <td class="matrix-cell">0</td>
                                    <td class="matrix-cell">${impact.microsoft.toFixed(2)}</td>
                                </tr>
                            </table>
                        </div>
                        <div class="text-2xl">√ó</div>
                        <div>
                            <table class="matrix-table">
                                <tr>
                                    <td class="matrix-cell">${portfolio.apple}</td>
                                </tr>
                                <tr>
                                    <td class="matrix-cell">${portfolio.google}</td>
                                </tr>
                                <tr>
                                    <td class="matrix-cell">${portfolio.microsoft}</td>
                                </tr>
                            </table>
                        </div>
                        <div class="text-2xl">=</div>
                        <div>
                            <table class="matrix-table">
                                <tr>
                                    <td class="matrix-cell">${Math.round(updatedPortfolio.apple)}</td>
                                </tr>
                                <tr>
                                    <td class="matrix-cell">${Math.round(updatedPortfolio.google)}</td>
                                </tr>
                                <tr>
                                    <td class="matrix-cell">${Math.round(updatedPortfolio.microsoft)}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                `;
                
                calculationStep2.innerHTML = `
                    <div class="font-mono">
                        [${impact.apple.toFixed(2)} √ó $${portfolio.apple}, ${impact.google.toFixed(2)} √ó $${portfolio.google}, ${impact.microsoft.toFixed(2)} √ó $${portfolio.microsoft}] =
                    </div>
                    <div class="font-mono mt-1">
                        [$${Math.round(updatedPortfolio.apple)}, $${Math.round(updatedPortfolio.google)}, $${Math.round(updatedPortfolio.microsoft)}]
                    </div>
                `;
                
                // Calculate the net change in portfolio value
                const initialTotal = portfolio.apple + portfolio.google + portfolio.microsoft;
                const updatedTotal = updatedPortfolio.apple + updatedPortfolio.google + updatedPortfolio.microsoft;
                const netChange = updatedTotal - initialTotal;
                const percentChange = (netChange / initialTotal) * 100;
                
                calculationStep3.innerHTML = `
                    <div>Initial Portfolio Value: $${initialTotal}</div>
                    <div>Updated Portfolio Value: $${Math.round(updatedTotal)}</div>
                    <div class="font-medium mt-1 ${netChange >= 0 ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}">
                        Net Change: ${netChange >= 0 ? '+' : ''}$${Math.round(netChange)} (${percentChange >= 0 ? '+' : ''}${percentChange.toFixed(2)}%)
                    </div>
                `;
            }
            
            function updatePortfolioChart() {
                const updatedPortfolio = calculateUpdatedPortfolio();
                
                const ctx = portfolioChart.getContext('2d');
                
                // Destroy previous chart if it exists
                if (portfolioBarChart) {
                    portfolioBarChart.destroy();
                }
                
                // Create new chart
                portfolioBarChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Apple', 'Google', 'Microsoft'],
                        datasets: [
                            {
                                label: 'Initial Portfolio',
                                data: [portfolio.apple, portfolio.google, portfolio.microsoft],
                                backgroundColor: 'rgba(93, 92, 222, 0.7)',
                                borderColor: 'rgba(93, 92, 222, 1)',
                                borderWidth: 1
                            },
                            {
                                label: 'Updated Portfolio',
                                data: [
                                    Math.round(updatedPortfolio.apple), 
                                    Math.round(updatedPortfolio.google), 
                                    Math.round(updatedPortfolio.microsoft)
                                ],
                                backgroundColor: 'rgba(56, 161, 105, 0.7)',
                                borderColor: 'rgba(56, 161, 105, 1)',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Value (Dollars)'
                                },
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value;
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': $' + context.raw;
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            function generateNewScenario() {
                // Generate new random portfolio values
                portfolio = {
                    apple: Math.floor(Math.random() * 5000) + 3000,
                    google: Math.floor(Math.random() * 5000) + 3000,
                    microsoft: Math.floor(Math.random() * 5000) + 3000
                };
                
                // Generate new random market impacts
                impact = {
                    apple: parseFloat((Math.random() * 0.2 - 0.1 + 1).toFixed(2)), // -10% to +10%
                    google: parseFloat((Math.random() * 0.2 - 0.1 + 1).toFixed(2)),
                    microsoft: parseFloat((Math.random() * 0.2 - 0.1 + 1).toFixed(2))
                };
                
                displayPortfolio();
                showCalculation();
            }
            
            // Event listeners
            showCalculationBtn.addEventListener('click', showCalculation);
            changeScenarioBtn.addEventListener('click', generateNewScenario);
            
            // Initialize the display
            displayPortfolio();
            showCalculation();
        }

        // Least Squares Regression Demo
        function initLeastSquaresDemo() {
            // Exercise time (x2) and weight change (y) dataset
            const dataset = [
                { x2: 1.0, y: -1.5 },
                { x2: 2.0, y: -2.8 },
                { x2: 3.0, y: -4.1 },
                { x2: 4.0, y: -5.6 },
                { x2: 5.0, y: -6.3 },
                { x2: 6.0, y: -7.9 }
            ];
            
            // Populate the data table
            const dataTable = document.getElementById('data-table');
            dataTable.innerHTML = '';
            
            dataset.forEach((data, index) => {
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-gray-100 dark:hover:bg-gray-600';
                row.innerHTML = `
                    <td class="py-2 px-4">${index + 1}</td>
                    <td class="py-2 px-4">${data.x2}</td>
                    <td class="py-2 px-4">${data.y}</td>
                `;
                dataTable.appendChild(row);
            });
            
            // Display system of equations
            const equationSystem = document.getElementById('equation-system');
            equationSystem.innerHTML = '';
            
            dataset.forEach((data, index) => {
                const equation = document.createElement('div');
                equation.innerHTML = `x‚ÇÅ + ${data.x2}a‚ÇÅ = ${data.y}`;
                equationSystem.appendChild(equation);
            });
            
            // Create the design matrix X (with 1's in first column for intercept)
            const X = dataset.map(data => [1, data.x2]);
            const y = dataset.map(data => [data.y]);
            
            // Display matrices
            const matrixX = document.getElementById('matrix-X');
            matrixX.innerHTML = `
                <div>X = </div>
                <table class="matrix-table mx-2">
                    ${X.map(row => `
                        <tr>
                            ${row.map(cell => `<td class="matrix-cell">${cell}</td>`).join('')}
                        </tr>
                    `).join('')}
                </table>
            `;
            
            const matrixBeta = document.getElementById('matrix-beta');
            matrixBeta.innerHTML = `
                <div>Œ≤ = </div>
                <table class="matrix-table mx-2">
                    <tr><td class="matrix-cell">x‚ÇÅ</td></tr>
                    <tr><td class="matrix-cell">a‚ÇÅ</td></tr>
                </table>
            `;
            
            const matrixY = document.getElementById('matrix-y');
            matrixY.innerHTML = `
                <div>y = </div>
                <table class="matrix-table mx-2">
                    ${y.map(row => `
                        <tr>
                            ${row.map(cell => `<td class="matrix-cell">${cell}</td>`).join('')}
                        </tr>
                    `).join('')}
                </table>
            `;
            
            // Calculate least squares solution
            const XT = math.transpose(X);
            const XTX = math.multiply(XT, X);
            const XTXInv = math.inv(XTX);
            const XTy = math.multiply(XT, y);
            const beta = math.multiply(XTXInv, XTy);
            
            // Function to display a matrix with proper formatting
            function displayMatrix(matrix, elementId) {
                const container = document.getElementById(elementId);
                container.innerHTML = `
                    <table class="matrix-table">
                        ${matrix.map(row => `
                            <tr>
                                ${row.map(cell => `<td class="matrix-cell">${typeof cell === 'number' ? cell.toFixed(2) : cell}</td>`).join('')}
                            </tr>
                        `).join('')}
                    </table>
                `;
            }
            
            // Show calculation steps when button is clicked
            const showStepsBtn = document.getElementById('show-ls-steps');
            const stepsContainer = document.getElementById('ls-steps-container');
            
            showStepsBtn.addEventListener('click', () => {
                stepsContainer.classList.remove('hidden');
                
                // Display all calculation steps
                displayMatrix(XT, 'step-xt');
                displayMatrix(XTX, 'step-xtx');
                displayMatrix(XTXInv, 'step-xtx-inv');
                displayMatrix(XTy, 'step-xty');
                displayMatrix(beta, 'step-beta');
                
                // Display the final regression equation
                const x1 = beta[0][0];
                const a1 = beta[1][0];
                
                const regressionEquation = document.getElementById('regression-equation');
                regressionEquation.innerHTML = `
                    y = ${x1.toFixed(2)} + ${a1.toFixed(2)}x‚ÇÇ
                `;
                
                // Interpret the results
                const interpretation = document.getElementById('equation-interpretation');
                interpretation.innerHTML = `
                    For each additional hour of exercise per week, weight change is expected to be ${Math.abs(a1).toFixed(2)} pounds ${a1 < 0 ? 'decrease' : 'increase'}.
                    The baseline weight change with no exercise is ${Math.abs(x1).toFixed(2)} pounds ${x1 < 0 ? 'decrease' : 'increase'}.
                `;
                
                // Update the chart with the regression line
                updateRegressionChart(x1, a1);
            });
            
            // Initialize the regression chart
            function initRegressionChart() {
                const ctx = document.getElementById('regression-chart').getContext('2d');
                
                // Create scatter plot of data
                const scatterChart = new Chart(ctx, {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            label: 'Data Points',
                            data: dataset.map(data => ({ x: data.x2, y: data.y })),
                            backgroundColor: 'rgba(93, 92, 222, 0.7)',
                            borderColor: 'rgba(93, 92, 222, 1)',
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Exercise Time (hours/week)'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Weight Change (pounds)'
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `(${context.parsed.x}, ${context.parsed.y})`;
                                    }
                                }
                            }
                        }
                    }
                });
                
                return scatterChart;
            }
            
            // Update chart with regression line
            function updateRegressionChart(x1, a1) {
                const ctx = document.getElementById('regression-chart').getContext('2d');
                
                // Get existing chart instance
                const chartInstance = Chart.getChart(ctx);
                
                // Generate points for the regression line
                const minX = 0;
                const maxX = 7;
                const lineData = [
                    { x: minX, y: x1 + a1 * minX },
                    { x: maxX, y: x1 + a1 * maxX }
                ];
                
                // Add the regression line to the chart
                if (chartInstance.data.datasets.length === 1) {
                    chartInstance.data.datasets.push({
                        label: 'Regression Line',
                        data: lineData,
                        backgroundColor: 'rgba(56, 161, 105, 0.7)',
                        borderColor: 'rgba(56, 161, 105, 1)',
                        borderWidth: 2,
                        pointRadius: 0,
                        showLine: true,
                        type: 'line'
                    });
                } else {
                    chartInstance.data.datasets[1].data = lineData;
                }
                
                chartInstance.update();
            }
            
            // Initialize the regression chart
            const regressionChart = initRegressionChart();
        }
    </script>
</body>
</html>